(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{109:function(e,n,t){"use strict";t.d(n,"a",(function(){return p})),t.d(n,"b",(function(){return m}));var a=t(0),i=t.n(a);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function l(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function b(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?l(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):l(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function c(e,n){if(null==e)return{};var t,a,i=function(e,n){if(null==e)return{};var t,a,i={},r=Object.keys(e);for(a=0;a<r.length;a++)t=r[a],n.indexOf(t)>=0||(i[t]=e[t]);return i}(e,n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)t=r[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(i[t]=e[t])}return i}var o=i.a.createContext({}),s=function(e){var n=i.a.useContext(o),t=n;return e&&(t="function"==typeof e?e(n):b(b({},n),e)),t},p=function(e){var n=s(e.components);return i.a.createElement(o.Provider,{value:n},e.children)},d={inlineCode:"code",wrapper:function(e){var n=e.children;return i.a.createElement(i.a.Fragment,{},n)}},u=i.a.forwardRef((function(e,n){var t=e.components,a=e.mdxType,r=e.originalType,l=e.parentName,o=c(e,["components","mdxType","originalType","parentName"]),p=s(t),u=a,m=p["".concat(l,".").concat(u)]||p[u]||d[u]||r;return t?i.a.createElement(m,b(b({ref:n},o),{},{components:t})):i.a.createElement(m,b({ref:n},o))}));function m(e,n){var t=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var r=t.length,l=new Array(r);l[0]=u;var b={};for(var c in n)hasOwnProperty.call(n,c)&&(b[c]=n[c]);b.originalType=e,b.mdxType="string"==typeof e?e:a,l[1]=b;for(var o=2;o<r;o++)l[o]=t[o];return i.a.createElement.apply(null,l)}return i.a.createElement.apply(null,t)}u.displayName="MDXCreateElement"},86:function(e,n,t){"use strict";t.r(n),t.d(n,"frontMatter",(function(){return l})),t.d(n,"metadata",(function(){return b})),t.d(n,"toc",(function(){return c})),t.d(n,"default",(function(){return s}));var a=t(3),i=t(7),r=(t(0),t(109)),l={id:"schema",title:"Workflow Schema"},b={unversionedId:"schema",id:"schema",isDocsHomePage:!1,title:"Workflow Schema",description:"A branch contains one or several stages. Stages can be independent and",source:"@site/docs/schema.md",slug:"/schema",permalink:"/docs/schema",editUrl:"https://github.com/kraken-ci/website/edit/master/docs/schema.md",version:"current",sidebar:"someSidebar",previous:{title:"Projects and Branches",permalink:"/docs/proj-branches"},next:{title:"Webhooks",permalink:"/docs/webhooks"}},c=[{value:"Schema Elements",id:"schema-elements",children:[]},{value:"Parent",id:"parent",children:[]},{value:"Triggers",id:"triggers",children:[{value:"parent",id:"parent-1",children:[]},{value:"interval",id:"interval",children:[]},{value:"date",id:"date",children:[]},{value:"cron",id:"cron",children:[]},{value:"repo",id:"repo",children:[]},{value:"manual",id:"manual",children:[]}]},{value:"Parameters",id:"parameters",children:[]},{value:"Configs",id:"configs",children:[]},{value:"Jobs",id:"jobs",children:[]},{value:"Step in Job",id:"step-in-job",children:[]},{value:"Built-in Step Tools",id:"built-in-step-tools",children:[{value:"Shell",id:"shell",children:[]},{value:"Git",id:"git",children:[]},{value:"Artifacts",id:"artifacts",children:[]},{value:"PyLint",id:"pylint",children:[]},{value:"PyTest",id:"pytest",children:[]},{value:"NgLint",id:"nglint",children:[]},{value:"Cloc",id:"cloc",children:[]},{value:"RndTest",id:"rndtest",children:[]}]},{value:"Environment in Job",id:"environment-in-job",children:[]},{value:"Notification",id:"notification",children:[]},{value:"Timeout",id:"timeout",children:[]}],o={toc:c};function s(e){var n=e.components,t=Object(i.a)(e,["components"]);return Object(r.b)("wrapper",Object(a.a)({},o,t,{components:n,mdxType:"MDXLayout"}),Object(r.b)("p",null,"A branch contains one or several stages. Stages can be independent and\nrun in parallel or chained and together can for a tree or a set of\ntrees (forest). Stage have a schema that defines what should be\ndone. Schema generally defines jobs for execution, execution\nenvironment, triggers that start the execution of whole schema,\noptional parameters and execution configuration."),Object(r.b)("p",null,"Full schema syntax is defined in ",Object(r.b)("a",Object(a.a)({parentName:"p"},{href:"schema-ref"}),"schema reference"),"."),Object(r.b)("h2",{id:"schema-elements"},"Schema Elements"),Object(r.b)("p",null,"There are defined several things in the schema:"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"parent")," stage"),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"triggers")),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"parameters")),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"configs")),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"jobs")),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"notification")),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"timeout"))),Object(r.b)("p",null,"Example:"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-json"}),'        "parent": "root",\n        "triggers": {\n            "parent": True\n        },\n        "parameters": [],\n        "configs": [],\n        "jobs": [{\n            "name": "hello",\n            "steps": [{\n                "tool": "shell",\n                "cmd": "echo \'Hello World\'"\n            }],\n            "environments": [{\n                "system": "centos-7",\n                "agents_group": "all",\n                "config": "default"\n            }]\n        }]\n')),Object(r.b)("h2",{id:"parent"},"Parent"),Object(r.b)("p",null,"Parent allows for defining a chain of dependencies between subsequent\nstages. Current stage will be started only when parent stage has been\nfinished.  The value of ",Object(r.b)("inlineCode",{parentName:"p"},"parent")," field is a name of a stage. If it is\nset to special value ",Object(r.b)("inlineCode",{parentName:"p"},"root")," than it means that the stage does not\ndepend on anything and can be started as the first stage or one of the\nfirst stages, just after triggering a new flow in a branch."),Object(r.b)("h2",{id:"triggers"},"Triggers"),Object(r.b)("p",null,"Triggers indicate what events may start a stage and create its new\nrun.  There are several events: ",Object(r.b)("inlineCode",{parentName:"p"},"parent"),", ",Object(r.b)("inlineCode",{parentName:"p"},"interval"),", ",Object(r.b)("inlineCode",{parentName:"p"},"date"),", ",Object(r.b)("inlineCode",{parentName:"p"},"cron"),",\n",Object(r.b)("inlineCode",{parentName:"p"},"repo")," and ",Object(r.b)("inlineCode",{parentName:"p"},"manual"),"."),Object(r.b)("p",null,"Whole flow and its root stages can be also triggered manually in web UI or by a\nwebhook. More about that in ",Object(r.b)("a",Object(a.a)({parentName:"p"},{href:"webhooks"}),"Webhooks chapter"),"."),Object(r.b)("h3",{id:"parent-1"},"parent"),Object(r.b)("p",null,"A stage is triggered by completion of a parent stage. It is defined as ",Object(r.b)("inlineCode",{parentName:"p"},'"parent": True'),"."),Object(r.b)("p",null,"Example:"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-json"}),'   "triggers": {\n      "parent": True\n   }\n')),Object(r.b)("h3",{id:"interval"},"interval"),Object(r.b)("p",null,"Given stage is triggered specified amount of time after competion of\nprevious run of this stage.  The duration can be specified in a human\nreadable way e.g. ",Object(r.b)("inlineCode",{parentName:"p"},"1d")," what means one day or ",Object(r.b)("inlineCode",{parentName:"p"},"3h 30m")," what means 3\nhours and 30 minutes."),Object(r.b)("p",null,"Example, start a new stage run every 10 minutes:"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-json"}),'   "triggers": {\n      "interval": "10m"\n   }\n')),Object(r.b)("h3",{id:"date"},"date"),Object(r.b)("p",null,"Given stage is triggered once, on specified date. The date can be\nprovided in human readable way, e.g.: ",Object(r.b)("inlineCode",{parentName:"p"},"2012-01-19 17:21:00")," or ",Object(r.b)("inlineCode",{parentName:"p"},"Sat\nSep 17 23:26:08 CEST 2016"),"."),Object(r.b)("p",null,"Example, start a new stage run once on indicate date:"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-json"}),'   "triggers": {\n      "date": "2012-01-19 17:21:00"\n   }\n')),Object(r.b)("h3",{id:"cron"},"cron"),Object(r.b)("p",null,"A stage is triggered on specified CRON rule e.g. ",Object(r.b)("inlineCode",{parentName:"p"},"* * 10 * *"),". There\nare always 5 items. Each item is separated by space. The items meaning\nare as follows: minutes, hours, days, months, dow (day of week).  The\npossible values for each item can be found on\n",Object(r.b)("a",Object(a.a)({parentName:"p"},{href:"https://apscheduler.readthedocs.io/en/stable/modules/triggers/cron.html?highlight=cron#introduction"}),"Advanced Python Scheduler web page")),Object(r.b)("p",null,"Example, start a new stage run always half past nine AM:"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-json"}),'   "triggers": {\n      "cron": "30 9 * * *"\n   }\n')),Object(r.b)("h3",{id:"repo"},"repo"),Object(r.b)("p",null,"Example, start a new stage run when there are new commits in master\nbranch of Kraken's repository; check for new commits every 60 minutes."),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-json"}),'   "triggers": {\n       "repo": {\n           "url": "https://github.com/Kraken-CI/kraken/",\n           "branch": "master",\n           "interval": "60m"\n       }\n   }\n')),Object(r.b)("p",null,"There is another way of trigger a run based on changes to a repository.\nCheck ",Object(r.b)("a",Object(a.a)({parentName:"p"},{href:"webhooks"}),"webhooks")," chapter for details."),Object(r.b)("h3",{id:"manual"},"manual"),Object(r.b)("p",null,"Stage may be configured in a way that it is not automatically started,\neven if its parent has completed. This can be achieved by ",Object(r.b)("inlineCode",{parentName:"p"},"manual"),"\ntrigger. When it is set to ",Object(r.b)("inlineCode",{parentName:"p"},"True")," then in a web UI its run is shown in\nblue and awaits user confirmation to start."),Object(r.b)("p",null,"Example:"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-json"}),'   "triggers": {\n      "manual": True\n   }\n')),Object(r.b)("h2",{id:"parameters"},"Parameters"),Object(r.b)("p",null,"When a flow is started manually it is possible to provide values for\nparameters defined in all stages in given branch. This allows\ncustomizing behaviour of a stage and its jobs."),Object(r.b)("p",null,"There can be defined multiple parameters in one stage. Each parameters\nhas the following fields:"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"name")," - a string that identifies a parameter"),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"type")," - a type of parameter, for now it can be only ",Object(r.b)("inlineCode",{parentName:"li"},"string")),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"default")," - a default value for a parameter, it is required"),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"description")," - a description of a parameter, it used when a\nparameter is presented in web UI")),Object(r.b)("p",null,"Default value for a parameter is required. It is used when a flow is\nstarted automatically. In that situation it is not possible to provide\nvalues for the parameters manually."),Object(r.b)("p",null,"Example:"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-json"}),'   "parameters": [{\n       "name": "COUNT",\n       "type": "string",\n       "default": "10",\n       "description": "Number of tests to generate"\n   }]\n')),Object(r.b)("p",null,"Then, in a job definition a parameter can be used by enclosing its\nname in ",Object(r.b)("inlineCode",{parentName:"p"},"#{...}"),", e.g.: ",Object(r.b)("inlineCode",{parentName:"p"},"#{COUNT}"),"."),Object(r.b)("p",null,"Using parameter ",Object(r.b)("inlineCode",{parentName:"p"},"COUNT")," example:"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-json"}),'    "jobs": [{\n        "name": "random tests",\n        "steps": [{\n            "tool": "rndtest",\n            "count": "#{COUNT}"\n        }],\n        ...\n    }]\n')),Object(r.b)("p",null,"or"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-json"}),'    "jobs": [{\n        "name": "random tests",\n        "steps": [{\n            "tool": "shell",\n            "cmd": "echo \'the count is #{COUNT}\'"\n        }],\n        ...\n    }]\n')),Object(r.b)("h2",{id:"configs"},"Configs"),Object(r.b)("p",null,"Not implemented yet."),Object(r.b)("h2",{id:"jobs"},"Jobs"),Object(r.b)("h2",{id:"step-in-job"},"Step in Job"),Object(r.b)("p",null,"Common step fields:"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"tool")),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"cwd")),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"timeout")),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"attempts")),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"sleep_time_after_attempt"))),Object(r.b)("h2",{id:"built-in-step-tools"},"Built-in Step Tools"),Object(r.b)("h3",{id:"shell"},"Shell"),Object(r.b)("p",null,"Fields:"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"cmd")),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"timeout")),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"user")," - by default kraken ",Object(r.b)("inlineCode",{parentName:"li"},"user")," is used, this field allows for changing user e.g. to ",Object(r.b)("inlineCode",{parentName:"li"},"root"))),Object(r.b)("p",null,"Example:"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-python"}),'   "steps": [{\n       "tool": "shell",\n       "cmd": "echo \'Hello World\'"\n   }]\n')),Object(r.b)("h3",{id:"git"},"Git"),Object(r.b)("p",null,"Fields:"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"checkout")),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"destination")),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"ssh-key")),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"access-token"))),Object(r.b)("p",null,"Example:"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-python"}),'   "steps": [{\n       "tool": "git",\n       "checkout": "https://github.com/Kraken-CI/kraken.git",\n       "branch": "master"\n   }]\n')),Object(r.b)("h3",{id:"artifacts"},"Artifacts"),Object(r.b)("p",null,"Fields:"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"action")),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"public")),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"source")),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"destination"))),Object(r.b)("h3",{id:"pylint"},"PyLint"),Object(r.b)("p",null,"Fields:"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"rcfile")),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"modules_or_packages"))),Object(r.b)("h3",{id:"pytest"},"PyTest"),Object(r.b)("p",null,"Fields:"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"params"))),Object(r.b)("h3",{id:"nglint"},"NgLint"),Object(r.b)("p",null,"No specific fields."),Object(r.b)("h3",{id:"cloc"},"Cloc"),Object(r.b)("p",null,"Fields:"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"not-match-f")),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"exclude-dir"))),Object(r.b)("h3",{id:"rndtest"},"RndTest"),Object(r.b)("p",null,"Fields:"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"count"))),Object(r.b)("h2",{id:"environment-in-job"},"Environment in Job"),Object(r.b)("p",null,"TODO"),Object(r.b)("h2",{id:"notification"},"Notification"),Object(r.b)("p",null,"TODO"),Object(r.b)("h2",{id:"timeout"},"Timeout"),Object(r.b)("p",null,"TODO"))}s.isMDXComponent=!0}}]);