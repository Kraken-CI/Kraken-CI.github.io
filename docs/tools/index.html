<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-tools" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.2">
<title data-rh="true">Tools | Kraken CI</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://kraken.ci/docs/tools"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Tools | Kraken CI"><meta data-rh="true" name="description" content="Overview"><meta data-rh="true" property="og:description" content="Overview"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://kraken.ci/docs/tools"><link data-rh="true" rel="alternate" href="https://kraken.ci/docs/tools" hreflang="en"><link data-rh="true" rel="alternate" href="https://kraken.ci/docs/tools" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://YHIPSVOLK3-dsn.algolia.net" crossorigin="anonymous"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Tools","item":"https://kraken.ci/docs/tools"}]}</script><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Kraken CI RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Kraken CI Atom Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-152860048-1"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-152860048-1",{anonymize_ip:!0}),gtag("config","G-XH68RHQVEL",{anonymize_ip:!0})</script>



<link rel="search" type="application/opensearchdescription+xml" title="Kraken CI" href="/opensearch.xml"><link rel="stylesheet" href="/assets/css/styles.f56f6407.css">
<script src="/assets/js/runtime~main.be58412f.js" defer="defer"></script>
<script src="/assets/js/main.c144f801.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>document.documentElement.setAttribute("data-theme","light"),document.documentElement.setAttribute("data-theme-choice","light"),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo-big2.svg" alt="Kraken Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo-big2.svg" alt="Kraken Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Kraken CI</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/">Docs</a><a href="http://lab.kraken.ci" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Demo<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><a class="navbar__item navbar__link" href="/docs/quick-start">Quick Start</a><a class="navbar__item navbar__link" href="/blog">Blog</a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Community</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/contrib-kraken">Contributing</a></li><li><a href="https://discord.gg/jUvSZ4S5m3" target="_blank" rel="noopener noreferrer" class="dropdown__link">Discord Server<svg width="12" height="12" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li><a href="https://github.com/Kraken-CI/kraken/discussions" target="_blank" rel="noopener noreferrer" class="dropdown__link">GitHub Discussions<svg width="12" height="12" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li><a href="https://groups.google.com/g/kraken-ci" target="_blank" rel="noopener noreferrer" class="dropdown__link">Google Discussion Group<svg width="12" height="12" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://github.com/sponsors/godfryd" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar-sponsor-item">Sponsor Us<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><a class="navbar__item navbar__link" href="/support">Support</a><a class="navbar__item navbar__link" href="/contact">Contact</a><a href="https://github.com/kraken-ci/kraken" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><a href="https://github.com/Kraken-CI/kraken/releases" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Download<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search (Meta+k)" aria-keyshortcuts="Meta+k"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 24 24" aria-hidden="true"><circle cx="11" cy="11" r="8" stroke="currentColor" fill="none" stroke-width="1.4"></circle><path d="m21 21-4.3-4.3" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/"><span title="Introduction" class="categoryLinkLabel_W154">Introduction</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/docs/proj-branches"><span title="Usage" class="categoryLinkLabel_W154">Usage</span></a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/proj-branches"><span title="Projects and Branches" class="linkLabel_WmDU">Projects and Branches</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/stages"><span title="Stages in a Branch" class="linkLabel_WmDU">Stages in a Branch</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/schema"><span title="Workflow Schema" class="linkLabel_WmDU">Workflow Schema</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/schema-data"><span title="Data in Schema" class="linkLabel_WmDU">Data in Schema</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/env-vars"><span title="Environment Variables" class="linkLabel_WmDU">Environment Variables</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/secrets"><span title="Secrets" class="linkLabel_WmDU">Secrets</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/docker-executor"><span title="Docker Executor" class="linkLabel_WmDU">Docker Executor</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/lxd-executor"><span title="LXD Executor" class="linkLabel_WmDU">LXD Executor</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/notifications"><span title="Notifications" class="linkLabel_WmDU">Notifications</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/webhooks"><span title="Webhooks" class="linkLabel_WmDU">Webhooks</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/autoscale-in-cloud"><span title="Autoscale in Cloud" class="linkLabel_WmDU">Autoscale in Cloud</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/test-results-basics"><span title="Test Results" class="categoryLinkLabel_W154">Test Results</span></a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/tools"><span title="Tools" class="linkLabel_WmDU">Tools</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/kkci"><span title="Kraken Client Tool" class="linkLabel_WmDU">Kraken Client Tool</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/migration"><span title="Migration" class="linkLabel_WmDU">Migration</span></a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/tf-junit"><span title="Testing Frameworks" class="categoryLinkLabel_W154">Testing Frameworks</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/agents"><span title="Administration" class="categoryLinkLabel_W154">Administration</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/guide-intro"><span title="Guides" class="categoryLinkLabel_W154">Guides</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/others"><span title="Competition" class="categoryLinkLabel_W154">Competition</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/contrib-kraken"><span title="Contributing" class="categoryLinkLabel_W154">Contributing</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/schema-ref"><span title="Reference" class="categoryLinkLabel_W154">Reference</span></a></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Usage</span></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Tools</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Tools</h1></header><h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="overview">Overview<a href="#overview" class="hash-link" aria-label="Direct link to Overview" title="Direct link to Overview" translate="no">​</a></h2>
<p>Tools are used for executing steps in a job. Each step indicates what
tool should be used for its execution. It can be e.g. a <code>shell</code> tool
to execute commands, other programs or a <code>git</code> tool for cloning Git
repository. A step can have several input fields with values that are
used by a tool.</p>
<p>There are several built-in tools. It is also possible to create
your own custom tool.</p>
<p>Built-in tools:</p>
<ul>
<li class="">git</li>
<li class="">shell</li>
<li class="">artifacts</li>
<li class="">cache</li>
<li class="">pytest</li>
<li class="">pylint</li>
<li class="">gotest</li>
<li class="">junit_collect</li>
<li class="">values_collect</li>
<li class="">cloc</li>
<li class="">nglint</li>
<li class="">rndtest</li>
<li class="">local_tool</li>
</ul>
<p>These tools are described in detail in <a class="" href="/docs/schema#built-in-step-tools">Workflow Schema chapter, Built-in Step Tools section</a>.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="custom-tools">Custom Tools<a href="#custom-tools" class="hash-link" aria-label="Direct link to Custom Tools" title="Direct link to Custom Tools" translate="no">​</a></h2>
<p>Tools can be written in Python. It is possible to write them in other
languages, but for Python there is already a framework that makes some
actions easier.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="architecture">Architecture<a href="#architecture" class="hash-link" aria-label="Direct link to Architecture" title="Direct link to Architecture" translate="no">​</a></h2>
<p>The picture below shows the architecture around Kraken tools.</p>
<img src="/img/tool-arch.png" style="margin:0 20% 15px 20%">
<p>Kraken Agent asks Kraken Server for a job using REST API. In the
received job, there are defined multiple steps. For each step, a tool
is indicated for its execution. Kraken Agent takes the tool and spawns
it in a separate process. In arguments passed to the tool, the agent
gives a special command and a path to a JSON file with step
details. The tool, during its execution, sends the progress of
execution using TCP and JSON messages. These messages may contain
chunks of executed tests with their results or chunks of discovered
issues. In the end, the tool returns the exit code. If it is non-zero,
then this means that some error occurred.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="interaction-between-a-tool-and-kraken-agent">Interaction Between a Tool and Kraken Agent<a href="#interaction-between-a-tool-and-kraken-agent" class="hash-link" aria-label="Direct link to Interaction Between a Tool and Kraken Agent" title="Direct link to Interaction Between a Tool and Kraken Agent" translate="no">​</a></h2>
<p>A tool communicates with Kraken Agent using a specific protocol using
JSON messages. Thanks to this it is possible to write your own custom
tools.</p>
<p>There are several ways a tool can get in interaction with Kraken
Server via Kraken Agent. Tools can:</p>
<ul>
<li class="">do nothing, just do its job and that&#x27;s it</li>
<li class="">return list of all available test cases (eg. <code>pytest</code> tool); this
allows pre-storing all test case results as <code>not run</code> initially and
also splitting execution of test cases to several jobs</li>
<li class="">report continuously test results (eg. <code>pytest</code> tool)</li>
<li class="">report continuously issues (eg. <code>pylint</code> tool)</li>
<li class="">report stored artifacts (eg. <code>artifacts</code> tool)</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="protocol-overview">Protocol Overview<a href="#protocol-overview" class="hash-link" aria-label="Direct link to Protocol Overview" title="Direct link to Protocol Overview" translate="no">​</a></h3>
<p>There is a defined protocol between Kraken Agent and a tool. It works
differently depending on the direction. Generally, an agent invokes one
of predefined commands of a tool and then a tool responds to the agent
via an HTTP connection using JSON as a response format, and at the end
the tool exits with an exit code.</p>
<p>The commands expected by Kraken Agent:</p>
<ul>
<li class=""><code>get_commands</code> - it should return a list of commands exposed by a tool;
this command must be provided by every tool</li>
<li class=""><code>collect_tests</code> - it returns a list of available tests according to
the specification provided by the step definition; optional</li>
<li class=""><code>run</code> - it should just execute a step; optional</li>
<li class=""><code>run_tests</code> - it executes tests according to specification provided
by step definition and report results live, progressively, one by one
if possible; optional</li>
<li class=""><code>run_analysis</code> - it should perform an analysis and report issues
live, progressively, one by one if possible</li>
</ul>
<p>One of <code>run*</code> commands must be provided by a tool.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="tool-framework">Tool Framework<a href="#tool-framework" class="hash-link" aria-label="Direct link to Tool Framework" title="Direct link to Tool Framework" translate="no">​</a></h3>
<p>Handling of commands and sending responses are quite automated by a
Python tool framework. The framework requires defining one of <code>run*</code>
functions and <code>collect_tests</code> function if wanted.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="example-of-simple-tool">Example of Simple Tool<a href="#example-of-simple-tool" class="hash-link" aria-label="Direct link to Example of Simple Tool" title="Direct link to Example of Simple Tool" translate="no">​</a></h3>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> os</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> utils</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">run</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">step</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">**</span><span class="token plain">kwargs</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    cmd </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> step</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;cmd&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    cwd </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> step</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">get</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;cwd&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">None</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    timeout </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(130, 170, 255)">int</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">step</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">get</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;timeout&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">60</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ret </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> utils</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">execute</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">cmd</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> cwd</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">cwd</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> timeout</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">timeout</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> ret </span><span class="token operator" style="color:rgb(137, 221, 255)">!=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> ret</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;cmd exited with non-zero retcode: %s&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">%</span><span class="token plain"> ret</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;&#x27;</span><br></span></code></pre></div></div>
<p>This is a simplified implementation of <code>shell</code> tool. It just executes
a <code>cmd</code> command provided in a step. It also uses optional <code>cwd</code> and
<code>timeout</code> parameters provided in a step.</p>
<p>The tool framework provides several helper modules. One of them is <code>utils</code>
that offers an <code>execute</code> function. To use it import the module:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> utils</span><br></span></code></pre></div></div>
<p>A <code>run</code> function must return an exit code (0 means all is ok) and a
message that, in case of an error, describes the error (otherwise it
returns &#x27;&#x27; empty string).</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="example-of-testing-tool">Example of Testing Tool<a href="#example-of-testing-tool" class="hash-link" aria-label="Direct link to Example of Testing Tool" title="Direct link to Example of Testing Tool" translate="no">​</a></h3>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> random</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">collect_tests</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">step</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># return list of available tests</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    tests </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;test.aaa&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;test.bbb&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;test.ccc&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> tests</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">run_tests</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">step</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> report_result</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token boolean" style="color:rgb(255, 88, 116)">None</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># Now, the step contains a list of tests reported</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># by collect_tests function. If there is no collect_tests</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># function then the run_tests function should determine</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># on its own scope of tests based of the step definition.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    tests </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> step</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;tests&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">for</span><span class="token plain"> test </span><span class="token keyword" style="font-style:italic">in</span><span class="token plain"> tests</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        cmd </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;command to execute a test&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># status should indicate test result: 0 - not run, 1 - passed, 2 - failed,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># 3 - error, 4 - disabled/skip, 5 - unsupported</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        result </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(130, 170, 255)">dict</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">cmd</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">cmd</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> test</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">test</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> status</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">random</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">choice</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">3</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">4</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">5</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># report_result is a callback provided by Kraken tool framework that sends back</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># the test result to the server</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        report_result</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">result</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;&#x27;</span><br></span></code></pre></div></div>
<p>The tool has a hardcoded list of tests to execute regardless of the
step definition. Generally, <code>collect_tests</code> function should return a
list of tests based on the step definition. Then the <code>run_tests</code> function
receives a list of tests in step definition and then it &quot;executes&quot; them
one by one, and then reports them using <code>report_result</code> callback from
Kraken tool framework.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="adding-custom-tool-to-kraken-server">Adding Custom Tool to Kraken Server<a href="#adding-custom-tool-to-kraken-server" class="hash-link" aria-label="Direct link to Adding Custom Tool to Kraken Server" title="Direct link to Adding Custom Tool to Kraken Server" translate="no">​</a></h2>
<p>There are numerous ways to add a new tool to Kraken Server. After
adding a tool to Kraken Server, it can be used in user-defined
workflows with stages and jobs.</p>
<p>The ways for adding a tool to Kraken Server are as follows:</p>
<ol>
<li class="">Adding a tool that is stored locally in a system</li>
<li class="">Uploading a tool to Kraken Server</li>
<li class="">Adding a tool from remote Git repository to Kraken Server</li>
</ol>
<p>In all these scenarios, a helper Kraken client tool <code>kkci</code> is used.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="kkci---kraken-client-tool">kkci - Kraken Client Tool<a href="#kkci---kraken-client-tool" class="hash-link" aria-label="Direct link to kkci - Kraken Client Tool" title="Direct link to kkci - Kraken Client Tool" translate="no">​</a></h3>
<p><code>kkci</code> provides multiple commands that help in various aspects related
to Kraken CI. One of key areas is support for the develepment and
management of custom tools for Kraken.</p>
<p><code>kkci</code> installation instruction can be found
here: <a class="" href="/docs/kkci#installation">kkci#installation</a>. The detailed list of
commands that help with custom tools are available
here: <a class="" href="/docs/kkci#tools-commands">kkci#tools-commands</a>.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="tool-meta-file">Tool Meta File<a href="#tool-meta-file" class="hash-link" aria-label="Direct link to Tool Meta File" title="Direct link to Tool Meta File" translate="no">​</a></h3>
<p>Before adding a tool to Kraken Server, there needs to be prepared a
meta file for a tool. It defines the capabilities of a tool like:</p>
<ul>
<li class=""><code>name</code> - a name of a tool;</li>
<li class=""><code>description</code> - a description of a tool, a few lines of text that
tells what a tool can do;</li>
<li class=""><code>location</code> - relative location, folder, of a tool main Python module
looking from meta tool file, it will be used for invoking a tool,
e.g. <code>.</code> or <code>src</code>;</li>
<li class=""><code>entry</code> - a name of a tool main Python module, e.g. <code>main</code>; it is
assumed that this module is stored in a file <code>entry</code> + <code>.py</code></li>
<li class=""><code>parameters</code> a definition in <a href="https://json-schema.org/" target="_blank" rel="noopener noreferrer" class="">JSON Schema</a>
of input parameters that are expected in
a <a class="" href="/docs/schema#steps-in-job">step definition</a> for this tool</li>
</ul>
<p>The format of a tool meta file is JSON. Here is an example:</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">{</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;name&quot;: &quot;pkg_install&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;description&quot;: &quot;A tool that allows for installing packages using various providers.&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;location&quot;: &quot;.&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;entry&quot;: &quot;main&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;parameters&quot;: {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        &quot;additionalProperties&quot;: false,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        &quot;required&quot;: [&quot;pkgs&quot;],</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        &quot;properties&quot;: {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            &quot;pkgs&quot;: {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                &quot;description&quot;: &quot;A list of packages to install.&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                &quot;type&quot;: &quot;string&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            },</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            &quot;provider&quot;: {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                &quot;description&quot;: &quot;A provider to be used to do installation.&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                &quot;enum&quot;: [&quot;apt&quot;, &quot;yum&quot;, &quot;dnf&quot;, &quot;apk&quot;]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre></div></div>
<p>More examples can be found in Kraken&#x27;s tools repository:
<a href="https://github.com/Kraken-CI/kraken-tools" target="_blank" rel="noopener noreferrer" class="">https://github.com/Kraken-CI/kraken-tools</a>.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="local-tools">Local Tools<a href="#local-tools" class="hash-link" aria-label="Direct link to Local Tools" title="Direct link to Local Tools" translate="no">​</a></h3>
<p>In the case of local tools, they are stored already in a system where
Kraken Agent is running (e.g. on baremetal system or inside Docker
image). So the only missing piece is informing Kraken Server about
this fact.</p>
<p>For that purpose, <code>kkci</code> is used and <code>tools register</code> command. It needs
a tool meta file that indicates the location of the tool on a local system.</p>
<p>The meta file <code>tool.json</code> example:</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">{</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;name&quot;: &quot;pkg_install&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;description&quot;: &quot;A tool that allows for installing packages using various providers.&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;location&quot;: &quot;/opt/kraken-tools/pkg_install&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;entry&quot;: &quot;main&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;parameters&quot;: {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        &quot;additionalProperties&quot;: false,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        &quot;required&quot;: [&quot;pkgs&quot;],</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        &quot;properties&quot;: {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            &quot;pkgs&quot;: {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                &quot;description&quot;: &quot;A list of packages to install.&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                &quot;type&quot;: &quot;string&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            },</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            &quot;provider&quot;: {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                &quot;description&quot;: &quot;A provider to be used to do installation.&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                &quot;enum&quot;: [&quot;apt&quot;, &quot;yum&quot;, &quot;dnf&quot;, &quot;apk&quot;]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre></div></div>
<p>This file says that the tool is located in
<code>/opt/kraken-tools/pkg_install</code> directory, in <code>main.py</code> module.</p>
<p>The register command example:</p>
<div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ kkci -s http://admin:admin@localhost:8080 tools register tool.json</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Stored tool pkg_install@dev5</span><br></span></code></pre></div></div>
<p>Now the tool may be used in a step in a workflow schema:</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">&quot;parent&quot;: &quot;root&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">&quot;triggers&quot;: {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;parent&quot;: True</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">},</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">&quot;parameters&quot;: [],</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">&quot;configs&quot;: [],</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">&quot;jobs&quot;: [{</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;name&quot;: &quot;hello&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;steps&quot;: [{</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        &quot;tool&quot;: &quot;pkg_install@dev5&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        &quot;pkgs&quot;: &quot;mc&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }],</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;environments&quot;: [{</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        &quot;system&quot;: &quot;any&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        &quot;agents_group&quot;: &quot;all&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        &quot;config&quot;: &quot;default&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}]</span><br></span></code></pre></div></div>
<p>In this example, a tool version <code>dev5</code> is used directly. It could be
just:</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;steps&quot;: [{</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        &quot;tool&quot;: &quot;pkg_install&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        &quot;pkgs&quot;: &quot;mc&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }],</span><br></span></code></pre></div></div>
<p>that says that the latest version of <code>pkg_install</code> tool should be used.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="tools-stored-in-kraken-server">Tools Stored in Kraken Server<a href="#tools-stored-in-kraken-server" class="hash-link" aria-label="Direct link to Tools Stored in Kraken Server" title="Direct link to Tools Stored in Kraken Server" translate="no">​</a></h3>
<p>Another way to provide a tool in Kraken is to store it on Kraken
Server in Minio. For that purpose, another <code>kkci</code> command can be used:
<code>tools upload</code>.</p>
<p>The meta file <code>tool.json</code> example:</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">{</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;name&quot;: &quot;pkg_install&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;description&quot;: &quot;A tool that allows for installing packages using various providers.&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;location&quot;: &quot;.&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;entry&quot;: &quot;main&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;parameters&quot;: {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        &quot;additionalProperties&quot;: false,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        &quot;required&quot;: [&quot;pkgs&quot;],</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        &quot;properties&quot;: {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            &quot;pkgs&quot;: {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                &quot;description&quot;: &quot;A list of packages to install.&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                &quot;type&quot;: &quot;string&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            },</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            &quot;provider&quot;: {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                &quot;description&quot;: &quot;A provider to be used to do installation.&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                &quot;enum&quot;: [&quot;apt&quot;, &quot;yum&quot;, &quot;dnf&quot;, &quot;apk&quot;]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre></div></div>
<p>In this case, the location parameter is not important as it is
overwritten by Kraken Server to a proper location to Minio, where the
tool will be stored. Still, it is important to indicate the main
module name and, in the example, it points to <code>main.py</code> again.</p>
<p>And now the upload command example:</p>
<div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ kkci -s http://admin:admin@localhost:8080 tools upload ./pkg-tool/tool.json</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">execute &#x27;python3 -m pip install -r requirements.txt --target=./vendor&#x27; in &#x27;/home/godfryd/repos/kraken/pkg-tool&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Collecting pycvs</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Using cached pycvs-0.0.3-py3-none-any.whl (8.8 kB)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Collecting colorama</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Using cached colorama-0.4.5-py2.py3-none-any.whl (16 kB)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Collecting pexpect</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Using cached pexpect-4.8.0-py2.py3-none-any.whl (59 kB)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Collecting ptyprocess&gt;=0.5</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Using cached ptyprocess-0.7.0-py2.py3-none-any.whl (13 kB)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Installing collected packages: ptyprocess, pexpect, colorama, pycvs</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Successfully installed colorama-0.4.5 pexpect-4.8.0 ptyprocess-0.7.0 pycvs-0.0.3</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">WARNING: You are using pip version 22.0.4; however, version 22.1.2 is available.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">You should consider upgrading via the &#x27;/home/godfryd/.cache/pypoetry/virtualenvs/krakenci-client-gzjv3aIZ-py3.10/bin/python3 -m pip install --upgrade pip&#x27; command.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Uploaded tool pkg_install@dev6</span><br></span></code></pre></div></div>
<p>Here <code>kkci</code> assumes that the tool source code is located in the same
folder as the meta file <code>tool.json</code> (it is called the tool
directory). So first, if in this folder there is <code>requirements.txt</code>
file then <code>kkci</code> install all dependencies to the temporary <code>vendor</code>
directory. Then <code>kkci</code> packs all files from the tool directory
together with the vendor directory into a zip package. In the end, the
package is uploaded to Kraken Server together with tool meta file
<code>tool.json</code>.</p>
<p>This way if there are any dependencies indicated in <code>requirements.txt</code>
file then they are stored together with a tool in Kraken Server and
are always the same during tool usage.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="tools-from-remote-git-repo">Tools from Remote Git Repo<a href="#tools-from-remote-git-repo" class="hash-link" aria-label="Direct link to Tools from Remote Git Repo" title="Direct link to Tools from Remote Git Repo" translate="no">​</a></h3>
<p>The last way for storing a custom tool is keeping it in Git
repository. <code>kkci</code> provides a command that allows registering
remotely stored custom tool.</p>
<p>The meta file <code>tool.json</code> example:</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">{</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;name&quot;: &quot;pkg_install&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;description&quot;: &quot;A tool that allows for installing packages using various providers.&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;location&quot;: &quot;.&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;entry&quot;: &quot;main&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;parameters&quot;: {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        &quot;additionalProperties&quot;: false,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        &quot;required&quot;: [&quot;pkgs&quot;],</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        &quot;properties&quot;: {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            &quot;pkgs&quot;: {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                &quot;description&quot;: &quot;A list of packages to install.&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                &quot;type&quot;: &quot;string&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            },</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            &quot;provider&quot;: {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                &quot;description&quot;: &quot;A provider to be used to do installation.&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                &quot;enum&quot;: [&quot;apt&quot;, &quot;yum&quot;, &quot;dnf&quot;, &quot;apk&quot;]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre></div></div>
<p>The location field needs to be a relative path to a directory with an
entry source module.</p>
<p>The <code>tools register-remote</code> looks as follows:</p>
<div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ kkci -s http://admin:admin@localhost:8080 tools register-remote \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">       -f pkg_install/tool.json https://github.com/Kraken-CI/kraken-tools</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Stored tool pkg_install@48d4c5e</span><br></span></code></pre></div></div>
<p><code>-f</code> parameter indicates a path in the repo to the tool meta file.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="list-registered-tool">List Registered Tool<a href="#list-registered-tool" class="hash-link" aria-label="Direct link to List Registered Tool" title="Direct link to List Registered Tool" translate="no">​</a></h3>
<p>When a custom tool is registered in Kraken Server using one of the
above commands, it is possible to check if our tool is in the list of
all tools in Kraken Server. For that purpose, there is a <code>tools list</code>
command:</p>
<div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ kkci -s http://admin:admin@localhost:8080 tools list</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Id  Name            Location                 Entry    Last Version</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">----  --------------  -----------------------  -------  --------------</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   5  artifacts                                         1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   9  cache                                             1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   7  cloc                                              1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   1  git                                               1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  10  gotest                                            1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  11  junit_collect                                     1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  16  local                                             1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  17  local_tool                                        1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   8  nglint                                            1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> 133  pkg_install     minio:tool-133/tool.zip  main     dev6</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   6  pylint                                            1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   3  pytest                                            1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   4  rndtest                                           1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   2  shell                                             1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  12  values_collect                                    1</span><br></span></code></pre></div></div>
<p>Yes, on the list, there is our tool, <code>pkg_install</code>. The last version is <code>dev6</code>.</p>
<p>To list all versions of a given tool there is <code>tools list-versions</code> command:</p>
<div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ kkci -s http://admin:admin@localhost:8080 tools list-versions pkg_install</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Id  Name         Location                             Entry    Version</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">----  -----------  -----------------------------------  -------  ---------</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> 133  pkg_install  minio:tool-133/tool.zip              main     dev6</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> 132  pkg_install  /home/godfryd/repos/kraken/pkg-tool  main     dev5</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> 131  pkg_install  minio:tool-131/tool.zip              main     48d4c5e</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> 130  pkg_install  /home/godfryd/repos/kraken/pkg-tool  main     dev4</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">...</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="running-a-tool-locally">Running a Tool Locally<a href="#running-a-tool-locally" class="hash-link" aria-label="Direct link to Running a Tool Locally" title="Direct link to Running a Tool Locally" translate="no">​</a></h2>
<p>Developing a new tool by uploading it after each code change would be tiresome.
It is quicker to run the tool locally and check if all works before uploading
the tool to Kraken Server.</p>
<p>A step file needs to be prepared to run the tool locally. This file
contains information on how the tool should be run i.e. it contains all
the arguments that the tool is expecting.</p>
<p>To make it easy, the step file can be generated semi-automatically based
on the meta tool file. This can be done in the following way using
<code>kkci</code>:</p>
<div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ kkci tools generate-step-file ./pkg-tool/tool.json</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Please, enter values for pkg_install tool parameters</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  pkgs (string): mc</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  provider (string, one of [&#x27;apt&#x27;, &#x27;yum&#x27;, &#x27;dnf&#x27;, &#x27;apk&#x27;]): apt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Step file stored to /home/godfryd/repos/kraken/pkg-tool/step.json</span><br></span></code></pre></div></div>
<p>As can be seen in the log, <code>kkci</code> asks for values for the required
parameters. The meta tool file defines such parameters: <code>pkgs</code> and
<code>provider</code>. If the parameter type is too complex (e.g. a structure)
then it needs to be set manually in the generated step file. The last
line in the log indicates the location of the generated step file.</p>
<p>Having the step file, we can run our tool locally. Again using <code>kkci</code>
it can be made in the following way:</p>
<div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ kkci tools run ./pkg_tool/tool.json -f ./pkg_tool/step.json</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">execute &#x27;python3 -m pip install -r requirements.txt --target=./vendor&#x27; in &#x27;/home/godfryd/repos/kraken/pkg-tool&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Collecting pycvs</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Using cached pycvs-0.0.3-py3-none-any.whl (8.8 kB)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Collecting colorama</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Using cached colorama-0.4.5-py2.py3-none-any.whl (16 kB)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Collecting pexpect</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Using cached pexpect-4.8.0-py2.py3-none-any.whl (59 kB)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Collecting ptyprocess&gt;=0.5</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Using cached ptyprocess-0.7.0-py2.py3-none-any.whl (13 kB)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Installing collected packages: ptyprocess, pexpect, colorama, pycvs</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Successfully installed colorama-0.4.5 pexpect-4.8.0 ptyprocess-0.7.0 pycvs-0.0.3</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">You should consider upgrading via the &#x27;/home/godfryd/.cache/pypoetry/virtualenvs/krakenci-client-gzjv3aIZ-py3.10/bin/python3 -m pip install --upgrade pip&#x27; command.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">execute &#x27;PYTHONPATH=/home/godfryd/repos/kraken/pkg-tool:/home/godfryd/repos/kraken/pkg-tool/vendor /home/godfryd/.cache/pypoetry/virtualenvs/krakenci-client-gzjv3aIZ-py3.10/bin/python -m kraken.agent.tool -m main -s ../pkg-tool/step.json check-integrity&#x27; in &#x27;None&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">execute &#x27;PYTHONPATH=/home/godfryd/repos/kraken/pkg-tool:/home/godfryd/repos/kraken/pkg-tool/vendor /home/godfryd/.cache/pypoetry/virtualenvs/krakenci-client-gzjv3aIZ-py3.10/bin/python -m kraken.agent.tool -m main -s ../pkg-tool/step.json get_commands&#x27; in &#x27;None&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">execute &#x27;PYTHONPATH=/home/godfryd/repos/kraken/pkg-tool:/home/godfryd/repos/kraken/pkg-tool/vendor /home/godfryd/.cache/pypoetry/virtualenvs/krakenci-client-gzjv3aIZ-py3.10/bin/python -m kraken.agent.tool -m main -s ../pkg-tool/step.json run&#x27; in &#x27;None&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">2022-08-11 08:07:41,871 run step tool pkg_install, cmd run</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">2022-08-11 08:07:41,992 exec: &#x27;sudo apt install --no-install-recommends -y mc&#x27; in &#x27;/home/godfryd/repos/kraken/client&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">2022-08-11 08:07:42,085 output:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Reading package lists...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">2022-08-11 08:07:42,583 output: Building dependency tree...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Reading state information...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">mc is already the newest version (3:4.8.27-1).</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">2022-08-11 08:07:42,675 output: 0 upgraded, 0 newly installed, 0 to remove and 16 not upgraded.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">2022-08-11 08:07:42,757 step tool pkg_install, cmd run done with retcode 0 in 1secs</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">2022-08-11 08:07:42,757 tool response: {&quot;status&quot;: &quot;done&quot;}</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="summary">Summary<a href="#summary" class="hash-link" aria-label="Direct link to Summary" title="Direct link to Summary" translate="no">​</a></h2>
<p>This is all in terms of custom tool development. This section presented:</p>
<ul>
<li class="">what is the custom tool and how it interacts with Kraken Server</li>
<li class=""><code>kkci</code> - CLI that provides useful operations around custom tools</li>
<li class="">a meta tool file that describes a custom tool</li>
<li class="">the three ways for storing custom tool for Kraken Server:<!-- -->
<ul>
<li class="">in a local system</li>
<li class="">in Kraken Server</li>
<li class="">in a Git repository</li>
</ul>
</li>
<li class="">listing stored tools in Kraken Server</li>
<li class="">running the custom tool locally</li>
</ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col noPrint_WFHX"><a href="https://github.com/kraken-ci/website/edit/master/docs/tools.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/test-results-tracking"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Tracking</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/kkci"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Kraken Client Tool</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#overview" class="table-of-contents__link toc-highlight">Overview</a></li><li><a href="#custom-tools" class="table-of-contents__link toc-highlight">Custom Tools</a></li><li><a href="#architecture" class="table-of-contents__link toc-highlight">Architecture</a></li><li><a href="#interaction-between-a-tool-and-kraken-agent" class="table-of-contents__link toc-highlight">Interaction Between a Tool and Kraken Agent</a><ul><li><a href="#protocol-overview" class="table-of-contents__link toc-highlight">Protocol Overview</a></li><li><a href="#tool-framework" class="table-of-contents__link toc-highlight">Tool Framework</a></li><li><a href="#example-of-simple-tool" class="table-of-contents__link toc-highlight">Example of Simple Tool</a></li><li><a href="#example-of-testing-tool" class="table-of-contents__link toc-highlight">Example of Testing Tool</a></li></ul></li><li><a href="#adding-custom-tool-to-kraken-server" class="table-of-contents__link toc-highlight">Adding Custom Tool to Kraken Server</a><ul><li><a href="#kkci---kraken-client-tool" class="table-of-contents__link toc-highlight">kkci - Kraken Client Tool</a></li><li><a href="#tool-meta-file" class="table-of-contents__link toc-highlight">Tool Meta File</a></li><li><a href="#local-tools" class="table-of-contents__link toc-highlight">Local Tools</a></li><li><a href="#tools-stored-in-kraken-server" class="table-of-contents__link toc-highlight">Tools Stored in Kraken Server</a></li><li><a href="#tools-from-remote-git-repo" class="table-of-contents__link toc-highlight">Tools from Remote Git Repo</a></li><li><a href="#list-registered-tool" class="table-of-contents__link toc-highlight">List Registered Tool</a></li></ul></li><li><a href="#running-a-tool-locally" class="table-of-contents__link toc-highlight">Running a Tool Locally</a></li><li><a href="#summary" class="table-of-contents__link toc-highlight">Summary</a></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/">Overview</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/quick-start/">Quick Start</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/proj-branches/">Usage</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/agents/">Administration</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/guide-intro/">Guides</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/schema-ref/">Reference</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/contrib-kraken">Contributing</a></li><li class="footer__item"><a href="https://discord.gg/bEw7Pemn" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord Server<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://github.com/Kraken-CI/kraken/discussions" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub Discussions<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://groups.google.com/g/kraken-ci" target="_blank" rel="noopener noreferrer" class="footer__link-item">Google Discussion Group<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Business</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/support">Support</a></li><li class="footer__item"><a class="footer__link-item" href="/contact">Contact</a></li><li class="footer__item"><a class="footer__link-item" href="/privacy-policy">Privacy Policy</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/kraken-ci/kraken" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://www.linkedin.com/company/kraken-ci" target="_blank" rel="noopener noreferrer" class="footer__link-item">LinkedIn<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 <a href="mailto:mike@kraken.ci">Michal Nowikowski</a>. Built with Docusaurus. Icons made by <a href="https://www.flaticon.com/authors/freepik">Freepik</a> from <a href="https://www.flaticon.com">flaticon</a></div></div></div></footer></div>
</body>
</html>