"use strict";(self.webpackChunkkraken_ci_website=self.webpackChunkkraken_ci_website||[]).push([[2826],{4137:function(e,n,t){t.d(n,{Zo:function(){return p},kt:function(){return m}});var o=t(7294);function l(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function r(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,o)}return t}function i(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?r(Object(t),!0).forEach((function(n){l(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):r(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function a(e,n){if(null==e)return{};var t,o,l=function(e,n){if(null==e)return{};var t,o,l={},r=Object.keys(e);for(o=0;o<r.length;o++)t=r[o],n.indexOf(t)>=0||(l[t]=e[t]);return l}(e,n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(o=0;o<r.length;o++)t=r[o],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(l[t]=e[t])}return l}var s=o.createContext({}),c=function(e){var n=o.useContext(s),t=n;return e&&(t="function"==typeof e?e(n):i(i({},n),e)),t},p=function(e){var n=c(e.components);return o.createElement(s.Provider,{value:n},e.children)},d={inlineCode:"code",wrapper:function(e){var n=e.children;return o.createElement(o.Fragment,{},n)}},k=o.forwardRef((function(e,n){var t=e.components,l=e.mdxType,r=e.originalType,s=e.parentName,p=a(e,["components","mdxType","originalType","parentName"]),k=c(t),m=l,u=k["".concat(s,".").concat(m)]||k[m]||d[m]||r;return t?o.createElement(u,i(i({ref:n},p),{},{components:t})):o.createElement(u,i({ref:n},p))}));function m(e,n){var t=arguments,l=n&&n.mdxType;if("string"==typeof e||l){var r=t.length,i=new Array(r);i[0]=k;var a={};for(var s in n)hasOwnProperty.call(n,s)&&(a[s]=n[s]);a.originalType=e,a.mdxType="string"==typeof e?e:l,i[1]=a;for(var c=2;c<r;c++)i[c]=t[c];return o.createElement.apply(null,i)}return o.createElement.apply(null,t)}k.displayName="MDXCreateElement"},8742:function(e,n,t){var o=t(7294);n.Z=function(e){var n=e.img;return o.createElement("a",{href:"/img/"+n,target:"blank"},o.createElement("img",{src:"/img/"+n,style:{boxShadow:"0 10px 10px 5px #777",marginBottom:"30px"}}))}},8333:function(e,n,t){t.r(n),t.d(n,{assets:function(){return p},contentTitle:function(){return s},default:function(){return m},frontMatter:function(){return a},metadata:function(){return c},toc:function(){return d}});var o=t(3117),l=t(102),r=(t(7294),t(4137)),i=(t(8742),["components"]),a={id:"kkci",title:"Kraken Client Tool"},s=void 0,c={unversionedId:"kkci",id:"kkci",title:"Kraken Client Tool",description:"Overview",source:"@site/docs/kkci.md",sourceDirName:".",slug:"/kkci",permalink:"/docs/kkci",draft:!1,editUrl:"https://github.com/kraken-ci/website/edit/master/docs/kkci.md",tags:[],version:"current",frontMatter:{id:"kkci",title:"Kraken Client Tool"},sidebar:"someSidebar",previous:{title:"Test Results Tracking",permalink:"/docs/test-results-tracking"},next:{title:"JUnit",permalink:"/docs/tf-junit"}},p={},d=[{value:"Overview",id:"overview",level:2},{value:"Installation",id:"installation",level:2},{value:"Tools Commands",id:"tools-commands",level:2},{value:"tools list",id:"tools-list",level:3},{value:"tools list-versions",id:"tools-list-versions",level:3},{value:"tools register",id:"tools-register",level:3},{value:"tools register-remote",id:"tools-register-remote",level:3},{value:"tools generate-step-file",id:"tools-generate-step-file",level:3},{value:"tools run",id:"tools-run",level:3},{value:"tools upload",id:"tools-upload",level:3},{value:"Auxiliary Commands",id:"auxiliary-commands",level:2},{value:"version",id:"version",level:3},{value:"server-version",id:"server-version",level:3},{value:"dump-workflow-schema",id:"dump-workflow-schema",level:3}],k={toc:d};function m(e){var n=e.components,t=(0,l.Z)(e,i);return(0,r.kt)("wrapper",(0,o.Z)({},k,t,{components:n,mdxType:"MDXLayout"}),(0,r.kt)("h2",{id:"overview"},"Overview"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"kkci")," is a tool that interacts with Kraken Server. It provides:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"tools"},"custom tools")," commands like list tools, register new tool or upload a tool code"),(0,r.kt)("li",{parentName:"ul"},"auxiliary commands - like get kkci or server versions")),(0,r.kt)("h2",{id:"installation"},"Installation"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"kkci")," is hosted on ",(0,r.kt)("a",{parentName:"p",href:"https://pypi.org"},"https://pypi.org")," and can be installed by ",(0,r.kt)("a",{parentName:"p",href:"https://pip.pypa.io/"},"pip tool"),"."),(0,r.kt)("p",null,"The command for ",(0,r.kt)("inlineCode",{parentName:"p"},"kkci")," installation looks as follows:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-console"},"$ pip install krakenci-client==0.980\nCollecting krakenci-client==0.980\n  Using cached krakenci-client-0.980.tar.gz (4.6 kB)\n  Installing build dependencies ... done\n  Getting requirements to build wheel ... done\n  Preparing metadata (pyproject.toml) ... done\nCollecting requests<3.0.0,>=2.26.0\n  Using cached requests-2.28.1-py3-none-any.whl (62 kB)\nCollecting click<8.0.0,>=7.1.2\n  Using cached click-7.1.2-py2.py3-none-any.whl (82 kB)\nCollecting tabulate<0.9.0,>=0.8.9\n  Downloading tabulate-0.8.10-py3-none-any.whl (29 kB)\nCollecting urllib3<1.27,>=1.21.1\n  Using cached urllib3-1.26.10-py2.py3-none-any.whl (139 kB)\nCollecting certifi>=2017.4.17\n  Using cached certifi-2022.6.15-py3-none-any.whl (160 kB)\nCollecting idna<4,>=2.5\n  Using cached idna-3.3-py3-none-any.whl (61 kB)\nCollecting charset-normalizer<3,>=2\n  Using cached charset_normalizer-2.1.0-py3-none-any.whl (39 kB)\nBuilding wheels for collected packages: krakenci-client\n  Building wheel for krakenci-client (pyproject.toml) ... done\n  Created wheel for krakenci-client: filename=krakenci_client-0.980-py3-none-any.whl size=4776 sha256=14c3ffa7b3676949839ddde24b82c6ffaa464dd55d17b69bbb55dffd48976162\n  Stored in directory: /home/godfryd/.cache/pip/wheels/78/10/bb/e935de7562c5b54ca6248247129a728662cab84f0a91ee6192\nSuccessfully built krakenci-client\nInstalling collected packages: urllib3, tabulate, idna, click, charset-normalizer, certifi, requests, krakenci-client\nSuccessfully installed certifi-2022.6.15 charset-normalizer-2.1.0 click-7.1.2 idna-3.3 krakenci-client-0.980 requests-2.28.1 tabulate-0.8.10 urllib3-1.26.10\n")),(0,r.kt)("p",null,"It is good to always indicate what ",(0,r.kt)("inlineCode",{parentName:"p"},"kkci")," version should be installed.\nIn the example above, there is ",(0,r.kt)("inlineCode",{parentName:"p"},"0.980")," version installed. The ",(0,r.kt)("inlineCode",{parentName:"p"},"kkci"),"\nversion needs to match the version of Kraken Server otherwise it\nwill not work."),(0,r.kt)("p",null,"The list of ",(0,r.kt)("inlineCode",{parentName:"p"},"kkci")," versions can be checked on PyPI profile page:\n",(0,r.kt)("a",{parentName:"p",href:"https://pypi.org/project/krakenci-client/#history"},"https://pypi.org/project/krakenci-client/#history"),". The version of\nKraken Server is presented on its web pages in the top left corner."),(0,r.kt)("h2",{id:"tools-commands"},"Tools Commands"),(0,r.kt)("h3",{id:"tools-list"},"tools list"),(0,r.kt)("p",null,"List Kraken Tools the last versions."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-console"},"$ kkci -s http://admin:admin@localhost:8080 tools list\n  Id  Name            Location                 Entry    Last Version\n----  --------------  -----------------------  -------  ------------\n   5  artifacts                                         1\n   9  cache                                             1\n   7  cloc                                              1\n   1  git                                               1\n  10  gotest                                            1\n  11  junit_collect                                     1\n  16  local                                             1\n  17  local_tool                                        1\n   8  nglint                                            1\n 131  pkg_install     minio:tool-131/tool.zip  main     48d4c5e\n   6  pylint                                            1\n   3  pytest                                            1\n   4  rndtest                                           1\n   2  shell                                             1\n  12  values_collect                                    1\n")),(0,r.kt)("h3",{id:"tools-list-versions"},"tools list-versions"),(0,r.kt)("p",null,"List all versions of the given Kraken Tool."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-console"},"$ kkci -s http://admin:admin@localhost:8080 tools list-versions pkg_install\n  Id  Name         Location                             Entry    Version\n----  -----------  -----------------------------------  -------  ---------\n 131  pkg_install  minio:tool-131/tool.zip              main     48d4c5e\n 130  pkg_install  /home/godfryd/repos/kraken/pkg-tool  main     dev4\n  98  pkg_install  /home/godfryd/repos/kraken/pkg-tool  main     dev3\n  97  pkg_install  /home/godfryd/repos/kraken/pkg-tool  main     dev2\n  96  pkg_install  /home/godfryd/repos/kraken/pkg-tool  main     dev1\n  95  pkg_install  /home/godfryd/repos/kraken/pkg-tool  main     14119\n  94  pkg_install  /home/godfryd/repos/kraken/pkg-tool  main     dev\n")),(0,r.kt)("h3",{id:"tools-register"},"tools register"),(0,r.kt)("p",null,"Register a new or overwrite the existing tool described in indicated TOOL_FILE."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-console"},"$ kkci -s http://admin:admin@localhost:8080 tools register tool.json\nStored tool pkg_install@dev5\n")),(0,r.kt)("h3",{id:"tools-register-remote"},"tools register-remote"),(0,r.kt)("p",null,"Register a tool located in a remote repository indicated by URL."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-console"},"$ kkci -s http://admin:admin@localhost:8080 tools register-remote \\\n       -f pkg_install/tool.json https://github.com/Kraken-CI/kraken-tools\nStored tool pkg_install@48d4c5e\n")),(0,r.kt)("h3",{id:"tools-generate-step-file"},"tools generate-step-file"),(0,r.kt)("p",null,"Generate a step file for a tool by indicating its TOOL-FILE. This step\nfile will allow running the tool on a local machine."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-console"},"$ kkci tools generate-step-file tool.json\nPlease, enter values for pkg_install tool parameters\n  pkgs (string): asd\n  provider (string, one of ['apt', 'yum', 'dnf', 'apk']): apt\n  aaa (integer): 1\ngit_cfg parameter is complex one, enter its value manually in the step file\n  background (boolean, default False):\nsource parameter is complex one, enter its value manually in the step file\nkeys parameter is complex one, enter its value manually in the step file\nStep file stored to step.json\n")),(0,r.kt)("h3",{id:"tools-run"},"tools run"),(0,r.kt)("p",null,"Run a tool on a local machine by indicating its TOOL-FILE with step file provide with -f option."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-console"},"$ kkci tools run tool.json -f step.json\nexecute 'python3 -m pip install -r requirements.txt --target=./vendor' in '/home/godfryd/repos/kraken-tools/pkg_install'\nCollecting distro\n  Using cached distro-1.7.0-py3-none-any.whl (20 kB)\nInstalling collected packages: distro\nSuccessfully installed distro-1.7.0\nWARNING: You are using pip version 22.0.4; however, version 22.1.2 is available.\nYou should consider upgrading via the '/home/godfryd/.cache/pypoetry/virtualenvs/krakenci-client-gzjv3aIZ-py3.10/bin/python3 -m pip install --upgrade pip' command.\nexecute 'PYTHONPATH=/home/godfryd/repos/kraken-tools/pkg_install:/home/godfryd/repos/kraken-tools/pkg_install/vendor /home/godfryd/.cache/pypoetry/virtualenvs/krakenci-client-gzjv3aIZ-py3.10/bin/python -m kraken.agent.tool -m main -s /home/godfryd/repos/kraken-tools/pkg_install/step.json check-integrity' in 'None'\nexecute 'PYTHONPATH=/home/godfryd/repos/kraken-tools/pkg_install:/home/godfryd/repos/kraken-tools/pkg_install/vendor /home/godfryd/.cache/pypoetry/virtualenvs/krakenci-client-gzjv3aIZ-py3.10/bin/python -m kraken.agent.tool -m main -s /home/godfryd/repos/kraken-tools/pkg_install/step.json get_commands' in 'None'\nexecute 'PYTHONPATH=/home/godfryd/repos/kraken-tools/pkg_install:/home/godfryd/repos/kraken-tools/pkg_install/vendor /home/godfryd/.cache/pypoetry/virtualenvs/krakenci-client-gzjv3aIZ-py3.10/bin/python -m kraken.agent.tool -m main -s /home/godfryd/repos/kraken-tools/pkg_install/step.json run' in 'None'\n2022-07-07 06:35:32,144 run step tool pkg_install, cmd run\n2022-07-07 06:35:32,272 exec: 'sudo dnf -y install mc' in '/home/godfryd/repos/kraken/client'\n2022-07-07 06:35:32,304 output: sudo: dnf: command not found\n2022-07-07 06:35:32,304 step tool pkg_install, cmd run done with retcode 1 in 0secs\n2022-07-07 06:35:32,305 tool response: {\"status\": \"error\", \"reason\": \"retcode\", \"retcode\": 1, \"msg\": \"cmd exited with non-zero retcode: 1\"}\n")),(0,r.kt)("h3",{id:"tools-upload"},"tools upload"),(0,r.kt)("p",null,"Upload tool's code from DIRECTORY to Kraken Server."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-console"},"$ kkci -s http://admin:admin@localhost:8080 tools upload ./pkg-tool/tool.json\nexecute 'python3 -m pip install -r requirements.txt --target=./vendor' in '/home/godfryd/repos/kraken/pkg-tool'\nCollecting pycvs\n  Using cached pycvs-0.0.3-py3-none-any.whl (8.8 kB)\nCollecting colorama\n  Using cached colorama-0.4.5-py2.py3-none-any.whl (16 kB)\nCollecting pexpect\n  Using cached pexpect-4.8.0-py2.py3-none-any.whl (59 kB)\nCollecting ptyprocess>=0.5\n  Using cached ptyprocess-0.7.0-py2.py3-none-any.whl (13 kB)\nInstalling collected packages: ptyprocess, pexpect, colorama, pycvs\nSuccessfully installed colorama-0.4.5 pexpect-4.8.0 ptyprocess-0.7.0 pycvs-0.0.3\nWARNING: You are using pip version 22.0.4; however, version 22.1.2 is available.\nYou should consider upgrading via the '/home/godfryd/.cache/pypoetry/virtualenvs/krakenci-client-gzjv3aIZ-py3.10/bin/python3 -m pip install --upgrade pip' command.\nUploaded tool pkg_install@dev6\n")),(0,r.kt)("h2",{id:"auxiliary-commands"},"Auxiliary Commands"),(0,r.kt)("h3",{id:"version"},"version"),(0,r.kt)("p",null,"Print a version of kkci."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-console"},"$ kkci version\n0.1\n")),(0,r.kt)("h3",{id:"server-version"},"server-version"),(0,r.kt)("p",null,"Print a version of Kraken Server indicated in ",(0,r.kt)("inlineCode",{parentName:"p"},"-s")," option."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-console"},"$ kkci -s http://admin:admin@localhost:8080 server-version\n0.1\n")),(0,r.kt)("h3",{id:"dump-workflow-schema"},"dump-workflow-schema"),(0,r.kt)("p",null,"Dump workflow schema in JSON format from indicated Kraken Server in\n",(0,r.kt)("inlineCode",{parentName:"p"},"-s")," option to indicated file."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-console"},"$ kkci -s http://admin:admin@localhost:8080 dump-workflow-schema schema.json\n")))}m.isMDXComponent=!0}}]);