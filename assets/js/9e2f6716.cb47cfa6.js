"use strict";(self.webpackChunkkraken_ci_website=self.webpackChunkkraken_ci_website||[]).push([[9490],{4137:function(e,t,n){n.d(t,{Zo:function(){return p},kt:function(){return k}});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},l=Object.keys(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var d=a.createContext({}),s=function(e){var t=a.useContext(d),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},p=function(e){var t=s(e.components);return a.createElement(d.Provider,{value:t},e.children)},m={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},u=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,l=e.originalType,d=e.parentName,p=o(e,["components","mdxType","originalType","parentName"]),u=s(n),k=r,c=u["".concat(d,".").concat(k)]||u[k]||m[k]||l;return n?a.createElement(c,i(i({ref:t},p),{},{components:n})):a.createElement(c,i({ref:t},p))}));function k(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var l=n.length,i=new Array(l);i[0]=u;var o={};for(var d in t)hasOwnProperty.call(t,d)&&(o[d]=t[d]);o.originalType=e,o.mdxType="string"==typeof e?e:r,i[1]=o;for(var s=2;s<l;s++)i[s]=n[s];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}u.displayName="MDXCreateElement"},8742:function(e,t,n){var a=n(7294);t.Z=function(e){var t=e.img;return a.createElement("a",{href:"/img/"+t,target:"blank"},a.createElement("img",{src:"/img/"+t,style:{boxShadow:"0 10px 10px 5px #777",marginBottom:"30px"}}))}},6314:function(e,t,n){n.r(t),n.d(t,{assets:function(){return m},contentTitle:function(){return s},default:function(){return c},frontMatter:function(){return d},metadata:function(){return p},toc:function(){return u}});var a=n(3117),r=n(102),l=(n(7294),n(4137)),i=n(8742),o=["components"],d={id:"schema-data",title:"Data in Schema"},s=void 0,p={unversionedId:"schema-data",id:"schema-data",title:"Data in Schema",description:"There is a lot of data, in various types, that can be used in",source:"@site/docs/schema-data.md",sourceDirName:".",slug:"/schema-data",permalink:"/docs/schema-data",draft:!1,editUrl:"https://github.com/kraken-ci/website/edit/master/docs/schema-data.md",tags:[],version:"current",frontMatter:{id:"schema-data",title:"Data in Schema"},sidebar:"someSidebar",previous:{title:"Workflow Schema",permalink:"/docs/schema"},next:{title:"Environment Variables",permalink:"/docs/env-vars"}},m={},u=[{value:"Context",id:"context",level:2},{value:"Interpolation",id:"interpolation",level:2},{value:"Data Overview",id:"data-overview",level:2},{value:"Environment Variables",id:"environment-variables",level:2},{value:"Secrets",id:"secrets",level:2},{value:"Workflow Objects Data",id:"workflow-objects-data",level:2},{value:"Project",id:"project",level:3},{value:"Branch",id:"branch",level:3},{value:"Stage",id:"stage",level:3},{value:"Flow",id:"flow",level:3},{value:"Run",id:"run",level:3},{value:"Flow and Run Sequences",id:"flow-and-run-sequences",level:3},{value:"Job",id:"job",level:3},{value:"Step",id:"step",level:3},{value:"Other",id:"other",level:3},{value:"User Parameters",id:"user-parameters",level:2},{value:"Example 1",id:"example-1",level:4},{value:"Example 2",id:"example-2",level:4},{value:"User Data",id:"user-data",level:2},{value:"Example 1",id:"example-1-1",level:4}],k={toc:u};function c(e){var t=e.components,n=(0,r.Z)(e,o);return(0,l.kt)("wrapper",(0,a.Z)({},k,n,{components:t,mdxType:"MDXLayout"}),(0,l.kt)("p",null,"There is a lot of data, in various types, that can be used in\nworkflow schema definitions. It can be accessed in two ways:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"via context that is passed to ",(0,l.kt)("inlineCode",{parentName:"li"},"stage")," function in stage code,"),(0,l.kt)("li",{parentName:"ul"},"using string interpolation.")),(0,l.kt)("h2",{id:"context"},"Context"),(0,l.kt)("p",null,"In the example code for the stage, a ",(0,l.kt)("inlineCode",{parentName:"p"},"ctx")," object is passed to the\n",(0,l.kt)("inlineCode",{parentName:"p"},"stage")," function. This context object allows access to various types\nof data."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-python"},'def stage(ctx):\n\n    if ctx.flow.kind == \'ci\':\n        systems = ["ubuntu:22.04", "debian:bullseye", "fedora:37", "rockylinux:8"]\n    else:\n        systems = ["ubuntu:22.04"]\n\n    return {\n        "parent": "root",\n        "triggers": {\n            "interval": "10m",\n        },\n        "jobs": [{\n            "name": "hello job",\n            "steps": [{\n            }, {\n                "tool": "shell",\n                "cmd": "echo \'hello world\'"\n            }],\n            "environments": [{\n                "executor": "docker",\n                "system": systems,\n                "agents_group": "all",\n                "config": "default"\n            }]\n        }]\n    }\n')),(0,l.kt)("h2",{id:"interpolation"},"Interpolation"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-python"},'def stage(ctx):\n    return {\n        "parent": "root",\n        "triggers": {\n            "interval": "10m",\n        },\n        "jobs": [{\n            "name": "job for branch #{branch.branch_name}",\n            "steps": [{\n                "tool": "shell",\n                "cmd": "echo \'hello world\'"\n            }],\n            "environments": [{\n                "system": "ubuntu-18.04",\n                "agents_group": "all",\n                "config": "default"\n            }]\n        }]\n    }\n')),(0,l.kt)("p",null,"In this example, there is a ",(0,l.kt)("inlineCode",{parentName:"p"},"branch.branch_name"),"\nvariable. Interpolation inside a string is done using the ",(0,l.kt)("inlineCode",{parentName:"p"},"#{...}"),"\noperator (hash and curly brackets, which is similar to Ruby's variable\ninterpolation in strings)."),(0,l.kt)("p",null,"User variables can be defined as parameters in stages\n(see ",(0,l.kt)("a",{parentName:"p",href:"schema#parameters"},"Parameters section in Workflow Schema chapter"),").\nThen they can be accessed using their name in uppercase."),(0,l.kt)("h2",{id:"data-overview"},"Data Overview"),(0,l.kt)("p",null,"There is several types of data:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"environment variables"),(0,l.kt)("li",{parentName:"ul"},"secrets"),(0,l.kt)("li",{parentName:"ul"},"workflow objects: ",(0,l.kt)("inlineCode",{parentName:"li"},"project"),", ",(0,l.kt)("inlineCode",{parentName:"li"},"branch"),", ",(0,l.kt)("inlineCode",{parentName:"li"},"stage"),", ",(0,l.kt)("inlineCode",{parentName:"li"},"flow"),", ",(0,l.kt)("inlineCode",{parentName:"li"},"run"),", ",(0,l.kt)("inlineCode",{parentName:"li"},"job")," and ",(0,l.kt)("inlineCode",{parentName:"li"},"step")),(0,l.kt)("li",{parentName:"ul"},"user parameters, these are input parameters to a stage that can be\nprovided by a user manually"),(0,l.kt)("li",{parentName:"ul"},"user data, data kept server-side that can be stored, update,\nmanipulated and used by workflow steps")),(0,l.kt)("h2",{id:"environment-variables"},"Environment Variables"),(0,l.kt)("p",null,"Environment variables are stored in a branch. They can be accessed in three ways:"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"traditionally, as environment variable in a shell: ",(0,l.kt)("inlineCode",{parentName:"li"},'"$MY_VAR"'),","),(0,l.kt)("li",{parentName:"ol"},"via string interpolation: ",(0,l.kt)("inlineCode",{parentName:"li"},'"#{env.MY_VAR}"'),","),(0,l.kt)("li",{parentName:"ol"},"via context: ",(0,l.kt)("inlineCode",{parentName:"li"},"ctx.env.MY_VAR"),".")),(0,l.kt)("p",null,"Example:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-python"},'def stage(ctx):\n    return {\n        "parent": "root",\n        "triggers": {\n            "parent": True,\n        },\n        "parameters": [],\n        "configs": [],\n        "jobs": [{\n            "name": "Env vars",\n            "steps": [{\n                "tool": "shell",\n                "cmd": "echo $MY_VAR"\n            }, {\n                "tool": "shell",\n                "cmd": "echo \'#{env.MY_VAR}\'"\n            }, {\n                "tool": "shell",\n                "cmd": "echo \'" + ctx.env.MY_VAR + "\'"\n            }],\n            "environments": [{\n                "system": "any",\n                "agents_group": "all",\n                "config": "default"\n            }]\n        }]\n    }\n')),(0,l.kt)("p",null,"More about environment variables can be found in ",(0,l.kt)("a",{parentName:"p",href:"env-vars"},"Environment Variables chapter"),"."),(0,l.kt)("h2",{id:"secrets"},"Secrets"),(0,l.kt)("p",null,"The values of secrets defined in a project can be accessed in the\nfollowing way:"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Secret","\xa0","Type"),(0,l.kt)("th",{parentName:"tr",align:null},"Access"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"Simple"),(0,l.kt)("td",{parentName:"tr",align:null},"From context: ",(0,l.kt)("inlineCode",{parentName:"td"},"ctx.secrets.<secret name>")," ",(0,l.kt)("br",null)," or via string interpolation: ",(0,l.kt)("inlineCode",{parentName:"td"},"#{secrets.<secret name>}"),", ",(0,l.kt)("br",null)," e.g. ",(0,l.kt)("inlineCode",{parentName:"td"},"ctx.secrets.access_token"))),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"SSH","\xa0","Key"),(0,l.kt)("td",{parentName:"tr",align:null},"From context: ",(0,l.kt)("inlineCode",{parentName:"td"},"ctx.secrets.<secret name>.user")," and ",(0,l.kt)("inlineCode",{parentName:"td"},"ctx.secrets.<secret name>.key")," ",(0,l.kt)("br",null)," or via string interpolation: ",(0,l.kt)("inlineCode",{parentName:"td"},"#{secrets.<secret name>.user}")," and ",(0,l.kt)("inlineCode",{parentName:"td"},"#{secrets.<secret name>.key}"),", ",(0,l.kt)("br",null)," e.g. ",(0,l.kt)("inlineCode",{parentName:"td"},"ctx.secrets.github_creds.user"))))),(0,l.kt)("p",null,"Legacy approach:"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Secret","\xa0","Type"),(0,l.kt)("th",{parentName:"tr",align:null},"Legacy Access"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"Simple"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"#{KK_SECRET_SIMPLE_<secret name>}"),", e.g. ",(0,l.kt)("inlineCode",{parentName:"td"},"#{KK_SECRET_SIMPLE_access_token}"))),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"SSH","\xa0","Key"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"#{KK_SECRET_USER_<secret_name>")," and ",(0,l.kt)("inlineCode",{parentName:"td"},"#{KK_SECRET_KEY_<secret_name>}"),", e.g. ",(0,l.kt)("inlineCode",{parentName:"td"},"#{KK_SECRET_USER_gitlab}")," and ",(0,l.kt)("inlineCode",{parentName:"td"},"#{KK_SECRET_KEY_gitlab}"))))),(0,l.kt)("p",null,"More about secrets can be found in ",(0,l.kt)("a",{parentName:"p",href:"secrets"},"Secrets chapter"),"."),(0,l.kt)("h2",{id:"workflow-objects-data"},"Workflow Objects Data"),(0,l.kt)("h3",{id:"project"},"Project"),(0,l.kt)("p",null,"In context: ",(0,l.kt)("inlineCode",{parentName:"p"},"ctx.project.<field-name>"),", in string interpolation: ",(0,l.kt)("inlineCode",{parentName:"p"},"#{project.<field-name>}"),"."),(0,l.kt)("p",null,"Available fields:"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Field"),(0,l.kt)("th",{parentName:"tr",align:null},"Description"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"id")),(0,l.kt)("td",{parentName:"tr",align:null},"Database ID of a project")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"created")),(0,l.kt)("td",{parentName:"tr",align:null},"Creation date and time")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"name")),(0,l.kt)("td",{parentName:"tr",align:null},"Name of a project")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"description")),(0,l.kt)("td",{parentName:"tr",align:null},"Description of a project")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"data")),(0,l.kt)("td",{parentName:"tr",align:null},"User data, see ",(0,l.kt)("a",{parentName:"td",href:"#user-data"},"User Data")," section")))),(0,l.kt)("p",null,"The example of this data can be seen in the screenshot below. This\nscreen displays a Project page with the Data tab open."),(0,l.kt)(i.Z,{img:"screen-data-project.png",mdxType:"Screen"}),(0,l.kt)("h3",{id:"branch"},"Branch"),(0,l.kt)("p",null,"In context: ",(0,l.kt)("inlineCode",{parentName:"p"},"ctx.branch.<field-name>"),", in string interpolation: ",(0,l.kt)("inlineCode",{parentName:"p"},"#{branch.<field-name>}"),"."),(0,l.kt)("p",null,"Available fields:"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Field"),(0,l.kt)("th",{parentName:"tr",align:null},"Description"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"id")),(0,l.kt)("td",{parentName:"tr",align:null},"Database ID of a branch")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"created")),(0,l.kt)("td",{parentName:"tr",align:null},"Creation date and time")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"name")),(0,l.kt)("td",{parentName:"tr",align:null},"Display name of a branch")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"branch_name")),(0,l.kt)("td",{parentName:"tr",align:null},"A name of a branch in a repository")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"retention_policy")),(0,l.kt)("td",{parentName:"tr",align:null},"Retention policy definition")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"data")),(0,l.kt)("td",{parentName:"tr",align:null},"User data shared for a branch, see ",(0,l.kt)("a",{parentName:"td",href:"#user-data"},"User Data")," section")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"data_ci")),(0,l.kt)("td",{parentName:"tr",align:null},"User data only related with CI flows, see ",(0,l.kt)("a",{parentName:"td",href:"#user-data"},"User Data")," section")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"data_dev")),(0,l.kt)("td",{parentName:"tr",align:null},"User data only related with Dev flows, see ",(0,l.kt)("a",{parentName:"td",href:"#user-data"},"User Data")," section")))),(0,l.kt)("p",null,"The example of this data can be seen in the screenshot below. This\nscreen displays the Branch Management page, specifically the Data tab."),(0,l.kt)(i.Z,{img:"screen-data-branch.png",mdxType:"Screen"}),(0,l.kt)("h3",{id:"stage"},"Stage"),(0,l.kt)("p",null,"In context: ",(0,l.kt)("inlineCode",{parentName:"p"},"ctx.stage.<field-name>"),", in string interpolation: ",(0,l.kt)("inlineCode",{parentName:"p"},"#{stage.<field-name>}"),"."),(0,l.kt)("p",null,"Available fields:"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Field"),(0,l.kt)("th",{parentName:"tr",align:null},"Description"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"id")),(0,l.kt)("td",{parentName:"tr",align:null},"Database ID of a stage")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"created")),(0,l.kt)("td",{parentName:"tr",align:null},"Creation date and time")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"name")),(0,l.kt)("td",{parentName:"tr",align:null},"Name of a stage")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"description")),(0,l.kt)("td",{parentName:"tr",align:null},"Description of a stage")))),(0,l.kt)("p",null,"The example of this data can be visible on the screenshot below. This\nscreen shows a Branch Management page, the Data tab of the selected stage."),(0,l.kt)(i.Z,{img:"screen-data-stage.png",mdxType:"Screen"}),(0,l.kt)("h3",{id:"flow"},"Flow"),(0,l.kt)("p",null,"In context: ",(0,l.kt)("inlineCode",{parentName:"p"},"ctx.flow.<field-name>"),", in string interpolation: ",(0,l.kt)("inlineCode",{parentName:"p"},"#{flow.<field-name>}"),"."),(0,l.kt)("p",null,"Available fields:"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Field"),(0,l.kt)("th",{parentName:"tr",align:null},"Description"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"id")),(0,l.kt)("td",{parentName:"tr",align:null},"Database ID of a flow")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"created")),(0,l.kt)("td",{parentName:"tr",align:null},"Creation date and time")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"kind")),(0,l.kt)("td",{parentName:"tr",align:null},"Kind of a flow, ",(0,l.kt)("inlineCode",{parentName:"td"},"ci")," or ",(0,l.kt)("inlineCode",{parentName:"td"},"dev"))),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"trigger")),(0,l.kt)("td",{parentName:"tr",align:null},"Trigger event information")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"seq")),(0,l.kt)("td",{parentName:"tr",align:null},"Sequence number for a flow, see ",(0,l.kt)("a",{parentName:"td",href:"#flow-and-run-sequences"},"Flow and Run Sequences")," section")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"data")),(0,l.kt)("td",{parentName:"tr",align:null},"User data, see ",(0,l.kt)("a",{parentName:"td",href:"#user-data"},"User Data")," section")))),(0,l.kt)("p",null,"The example of this data can be seen in the screenshot below. This\nscreen displays a Flow page with the Data tab."),(0,l.kt)(i.Z,{img:"screen-data-flow.png",mdxType:"Screen"}),(0,l.kt)("h3",{id:"run"},"Run"),(0,l.kt)("p",null,"In context: ",(0,l.kt)("inlineCode",{parentName:"p"},"ctx.run.<field-name>"),", in string interpolation: ",(0,l.kt)("inlineCode",{parentName:"p"},"#{run.<field-name>}"),"."),(0,l.kt)("p",null,"Available fields:"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Field"),(0,l.kt)("th",{parentName:"tr",align:null},"Description"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"id")),(0,l.kt)("td",{parentName:"tr",align:null},"Database ID of a run")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"created")),(0,l.kt)("td",{parentName:"tr",align:null},"Creation date and time")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"seq")),(0,l.kt)("td",{parentName:"tr",align:null},"Sequence number for a run, see ",(0,l.kt)("a",{parentName:"td",href:"#flow-and-run-sequences"},"Flow and Run Sequences")," section")))),(0,l.kt)("p",null,"The example data can be seen in the screenshot below. This screen\ndisplays a Flow page, with the Data tab selected for the specific run."),(0,l.kt)(i.Z,{img:"screen-data-run.png",mdxType:"Screen"}),(0,l.kt)("h3",{id:"flow-and-run-sequences"},"Flow and Run Sequences"),(0,l.kt)("p",null,"Flows and Runs has predefined sequences that are incremented with each\nnew flow or run. Additionally, there variants specific to flow kinds\nsuch as CI and DEV."),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Sequence Name"),(0,l.kt)("th",{parentName:"tr",align:null},"Deprecated Name"),(0,l.kt)("th",{parentName:"tr",align:null},"Description"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"flow.seq.shared")),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"KK_FLOW_SEQ")),(0,l.kt)("td",{parentName:"tr",align:null},"A variable that returns a sequence value for flows. The sequence is incremented with each flow regardless of its type, ie. it is shared between flow types.")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"flow.seq.own")),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"KK_CI_DEV_FLOW_SEQ")),(0,l.kt)("td",{parentName:"tr",align:null},"A variable that returns a sequence value for flows. The sequence is incremented with each flow of given type (CI/DEV), ie. it is handled separately for each flow type.")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"run.seq.shared")),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"KK_RUN_SEQ")),(0,l.kt)("td",{parentName:"tr",align:null},"A variable that returns a sequence value for runs of given stage. The sequence is incremented with each run regardless of flow type, ie. it is shared between flow types.")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"run.seq.own")),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"KK_CI_DEV_RUN_SEQ")),(0,l.kt)("td",{parentName:"tr",align:null},"A variable that returns a sequence value for runs of given stage. The sequence is incremented with each run of given flow type (CI/DEV), ie. it is handled separately for each flow type.")))),(0,l.kt)("p",null,"Example:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-python"},'{\n    ...\n    "flow_label": "bld-#{flow.seq.own}",\n    ...\n}\n')),(0,l.kt)("h3",{id:"job"},"Job"),(0,l.kt)("p",null,"In context: ",(0,l.kt)("inlineCode",{parentName:"p"},"ctx.job.<field-name>"),", in string interpolation: ",(0,l.kt)("inlineCode",{parentName:"p"},"#{job.<field-name>}"),"."),(0,l.kt)("p",null,"Available fields:"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Field"),(0,l.kt)("th",{parentName:"tr",align:null},"Description"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"id")),(0,l.kt)("td",{parentName:"tr",align:null},"Database ID of a job")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"created")),(0,l.kt)("td",{parentName:"tr",align:null},"Creation date and time")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"name")),(0,l.kt)("td",{parentName:"tr",align:null},"Name of a job")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"steps")),(0,l.kt)("td",{parentName:"tr",align:null},"A list of steps. More details below, in ",(0,l.kt)("a",{parentName:"td",href:"#step"},"Step")," section.")))),(0,l.kt)("p",null,"The example of this data can be seen in the screenshot below. This\nscreen displays the Run page and the Data tab of the selected job."),(0,l.kt)(i.Z,{img:"screen-data-job.png",mdxType:"Screen"}),(0,l.kt)("h3",{id:"step"},"Step"),(0,l.kt)("p",null,"In context: ",(0,l.kt)("inlineCode",{parentName:"p"},"ctx.step.<field-name>"),", in string interpolation: ",(0,l.kt)("inlineCode",{parentName:"p"},"#{step.<field-name>}"),"."),(0,l.kt)("p",null,"Available fields:"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Field"),(0,l.kt)("th",{parentName:"tr",align:null},"Description"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"id")),(0,l.kt)("td",{parentName:"tr",align:null},"Database ID of a step")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"index")),(0,l.kt)("td",{parentName:"tr",align:null},"Index of a step in a steps list, starts from 0")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"tool")),(0,l.kt)("td",{parentName:"tr",align:null},"A name of a tool that is used in this step")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"cmd")),(0,l.kt)("td",{parentName:"tr",align:null},"Command that was executed in step")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"job_id")),(0,l.kt)("td",{parentName:"tr",align:null},"Job ID in database")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"name")),(0,l.kt)("td",{parentName:"tr",align:null},"Name of the step")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"result")),(0,l.kt)("td",{parentName:"tr",align:null},"Result of the step execution")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"result.duration")),(0,l.kt)("td",{parentName:"tr",align:null},"Duration of the step")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"result.msg")),(0,l.kt)("td",{parentName:"tr",align:null},"Error message. Present only when the step erred.")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"result.reason")),(0,l.kt)("td",{parentName:"tr",align:null},"Reason of the error. Present only when the step erred.")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"result.retcode")),(0,l.kt)("td",{parentName:"tr",align:null},"Return code of the step executing process. Present only when the step erred and returned non-zero return code.")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"status")),(0,l.kt)("td",{parentName:"tr",align:null},"Execution status, integer. ",(0,l.kt)("inlineCode",{parentName:"td"},"0")," - not started, ",(0,l.kt)("inlineCode",{parentName:"td"},"1")," - in progress, ",(0,l.kt)("inlineCode",{parentName:"td"},"2")," - done (success), ",(0,l.kt)("inlineCode",{parentName:"td"},"3")," - error (failure), ",(0,l.kt)("inlineCode",{parentName:"td"},"4")," - skipped (also treated as success).")))),(0,l.kt)("p",null,"The example of this data can be seen in the screenshot above. This\nscreen displays the Run page and the Data tab of the selected job."),(0,l.kt)("h3",{id:"other"},"Other"),(0,l.kt)("p",null,"Available fields:"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Field"),(0,l.kt)("th",{parentName:"tr",align:null},"Description"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"is_ci")),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"True")," if this is CI flow, otherwise ",(0,l.kt)("inlineCode",{parentName:"td"},"False"))),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"is_dev")),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"True")," if this is Dev flow, otherwise ",(0,l.kt)("inlineCode",{parentName:"td"},"False"))))),(0,l.kt)("h2",{id:"user-parameters"},"User Parameters"),(0,l.kt)("p",null,"The description for defining user parameters can be found in the\n",(0,l.kt)("a",{parentName:"p",href:"schema#parameters"},"Parameters section in Schema chapter"),"."),(0,l.kt)("p",null,"Arguments provided for user parameters can be accessed from a context\n(",(0,l.kt)("inlineCode",{parentName:"p"},"ctx.args.<arg-name>"),") and also using string interpolation (",(0,l.kt)("inlineCode",{parentName:"p"},"#{args.<arg-name>}"),")."),(0,l.kt)("p",null,"The following examples show how arguments can be used in a stage code."),(0,l.kt)("h4",{id:"example-1"},"Example 1"),(0,l.kt)("p",null,"Accessing user arguments from the context:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-python"},'def stage(ctx):\n\n    if ctx.args.testing_scope == \'full\':\n        systems = ["ubuntu:22.04", "debian:bullseye", "fedora:37", "rockylinux:8"]\n    else:\n        systems = ["ubuntu:22.04"]\n\n    return {\n        "parent": "root",\n        "triggers": {\n            "interval": "10m",\n        },\n        "parameters": [{\n            "name": "testing_scope",\n            "type": "string",\n            "default": "full",\n            "description": "Scope of tests. \'full\' or \'limited\'."\n        }],\n        "jobs": [{\n            "name": "hello job",\n            "steps": [{\n                "tool": "shell",\n                "cmd": "echo \'hello world\'"\n            }],\n            "environments": [{\n                "executor": "docker",\n                "system": systems,\n                "agents_group": "all",\n                "config": "default"\n            }]\n        }]\n    }\n')),(0,l.kt)("p",null,"Here, the ",(0,l.kt)("inlineCode",{parentName:"p"},"testing_scope")," user parameter is used to determine the\nscope of testing. If the user provides the value ",(0,l.kt)("inlineCode",{parentName:"p"},"full")," for\n",(0,l.kt)("inlineCode",{parentName:"p"},"testing_scope"),", then testing will be conducted across several\noperating systems. Otherwise, testing will be limited to a single\nsystem."),(0,l.kt)("p",null,"At first glance, it may look weird that the argument is being used in\nthe if condition before being defined. The stage function is executed\nmultiple times at different time intervals. During the very first\nexecution, all variables in the context are, by default, set to\nzero. Therefore, in that execution round, the parameters are\ndefined. In the next execution, the parameters are defined, and their\ndefault or user-provided values are known."),(0,l.kt)("h4",{id:"example-2"},"Example 2"),(0,l.kt)("p",null,"Using string interpolation:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-python"},'def stage(ctx):\n    return {\n        "parent": "root",\n        "triggers": {\n            "interval": "10m",\n        },\n        "parameters": [{\n            "name": "count",\n            "type": "string",\n            "default": "10",\n            "description": "Number of tests to generate"\n        }],\n        "jobs": [{\n            "name": "random tests",\n            "steps": [{\n                "tool": "shell",\n                "cmd": "echo \'the count is #{args.count}\'"\n            }, {\n                "tool": "rndtest",\n                "count": "#{args.count}"\n            }],\n            "environments": [{\n                "executor": "docker",\n                "system": systems,\n                "agents_group": "all",\n                "config": "default"\n            }]\n        }]\n    }\n')),(0,l.kt)("p",null,"In the parameters section, the ",(0,l.kt)("inlineCode",{parentName:"p"},"count")," parameter is defined. Then,\nin the steps, it is used via string interpolation, i.e. ",(0,l.kt)("inlineCode",{parentName:"p"},"#{args.count}"),"."),(0,l.kt)("h2",{id:"user-data"},"User Data"),(0,l.kt)("p",null,"Instructions on how to manipulate user data can be found in\nthe ",(0,l.kt)("a",{parentName:"p",href:"/docs/schema#data"},"Data tool section in Schema chapter"),"."),(0,l.kt)("p",null,"User data that has already been stored can be accessed from the stage\ncontext and through string interpolation."),(0,l.kt)("h4",{id:"example-1-1"},"Example 1"),(0,l.kt)("p",null,"Using data from stage context:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-python"},'def stage(ctx):\n    jobs = []\n    for ts in ctx.flow.data.tests:\n        jobs.append({\n            "name": "tests %s" % ts,\n            "steps": [{\n                "tool": "shell",\n                "cmd": "echo \'run tests %s\'" % ts\n            }],\n            "environments": [{\n                "executor": "docker",\n                "system": "ubuntu:22.04",\n                "agents_group": "all",\n                "config": "default"\n            }]\n        })\n\n    return {\n        "parent": "root",\n        "triggers": {\n            "parent": True,\n        },\n        "jobs": jobs\n    }\n')),(0,l.kt)("p",null,"In this example, the ",(0,l.kt)("inlineCode",{parentName:"p"},"tests")," data should have already been set or\nupdated in the current flow, for example, in a previous stage where\nthe scope of tests was acquired from some external source. Now, in the\ncurrent stage, this acquired scope is being used to define jobs in the\nfor loop."),(0,l.kt)("p",null,"Check full example code on ",(0,l.kt)("a",{parentName:"p",href:"https://github.com/Kraken-CI/workflow-examples/tree/main/dynamic-schema"},"https://github.com/Kraken-CI/workflow-examples/tree/main/dynamic-schema")))}c.isMDXComponent=!0}}]);