(self.webpackChunkkraken_ci_website=self.webpackChunkkraken_ci_website||[]).push([[4990],{4137:function(e,n,t){"use strict";t.d(n,{Zo:function(){return u},kt:function(){return m}});var a=t(7294);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function i(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function o(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?i(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):i(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function s(e,n){if(null==e)return{};var t,a,r=function(e,n){if(null==e)return{};var t,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)t=i[a],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)t=i[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var c=a.createContext({}),l=function(e){var n=a.useContext(c),t=n;return e&&(t="function"==typeof e?e(n):o(o({},n),e)),t},u=function(e){var n=l(e.components);return a.createElement(c.Provider,{value:n},e.children)},p={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},d=a.forwardRef((function(e,n){var t=e.components,r=e.mdxType,i=e.originalType,c=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),d=l(t),m=r,g=d["".concat(c,".").concat(m)]||d[m]||p[m]||i;return t?a.createElement(g,o(o({ref:n},u),{},{components:t})):a.createElement(g,o({ref:n},u))}));function m(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var i=t.length,o=new Array(i);o[0]=d;var s={};for(var c in n)hasOwnProperty.call(n,c)&&(s[c]=n[c]);s.originalType=e,s.mdxType="string"==typeof e?e:r,o[1]=s;for(var l=2;l<i;l++)o[l]=t[l];return a.createElement.apply(null,o)}return a.createElement.apply(null,t)}d.displayName="MDXCreateElement"},8742:function(e,n,t){"use strict";var a=t(7294);n.Z=function(e){var n=e.img;return a.createElement("img",{src:"/img/"+n,style:{boxShadow:"0 10px 10px 5px #777",marginBottom:"30px"}})}},3147:function(e,n,t){"use strict";t.r(n),t.d(n,{frontMatter:function(){return c},contentTitle:function(){return l},metadata:function(){return u},toc:function(){return p},default:function(){return m}});var a=t(2122),r=t(9756),i=(t(7294),t(4137)),o=t(8742),s=["components"],c={id:"autoscale-in-cloud",title:"Autoscale in Cloud"},l=void 0,u={unversionedId:"autoscale-in-cloud",id:"autoscale-in-cloud",isDocsHomePage:!1,title:"Autoscale in Cloud",description:"Kraken CI allows for creating executing machines dynamically in the",source:"@site/docs/autoscale-in-cloud.mdx",sourceDirName:".",slug:"/autoscale-in-cloud",permalink:"/docs/autoscale-in-cloud",editUrl:"https://github.com/kraken-ci/website/edit/master/docs/autoscale-in-cloud.mdx",version:"current",frontMatter:{id:"autoscale-in-cloud",title:"Autoscale in Cloud"},sidebar:"someSidebar",previous:{title:"LXD Executor",permalink:"/docs/lxd-executor"},next:{title:"Test Results",permalink:"/docs/test-results"}},p=[{value:"Global Cloud Settings",id:"global-cloud-settings",children:[]},{value:"Preparing Cloud Environment",id:"preparing-cloud-environment",children:[]},{value:"Configuration in Agents Groups",id:"configuration-in-agents-groups",children:[]},{value:"Usage",id:"usage",children:[]}],d={toc:p};function m(e){var n=e.components,t=(0,r.Z)(e,s);return(0,i.kt)("wrapper",(0,a.Z)({},d,t,{components:n,mdxType:"MDXLayout"}),(0,i.kt)("p",null,"Kraken CI allows for creating executing machines dynamically in the\ncloud when they are needed. They can be either virtual machines or\ncontainers. When new jobs are triggered and there are no agents\navailable for them, new machines with Kraken agents are\nspawned. The configuration of the way of spawning new machines is\nlocated in agent groups."),(0,i.kt)("p",null,"Currently, Kraken CI autoscaling is supporting:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"AWS EC2 virtual machines")),(0,i.kt)("h2",{id:"global-cloud-settings"},"Global Cloud Settings"),(0,i.kt)("p",null,"First, global settings have to be set to allow access to a given cloud\nprovider. In Web UI, on Kraken -> Settings page, in Cloud tab,\nthere is a form for collecting credentials to cloud providers:"),(0,i.kt)(o.Z,{img:"screen-settings-cloud.png",mdxType:"Screen"}),(0,i.kt)("p",null,"In the case of AWS, there are required ",(0,i.kt)("inlineCode",{parentName:"p"},"Access Key")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"Secret Access Key"),"."),(0,i.kt)("h2",{id:"preparing-cloud-environment"},"Preparing Cloud Environment"),(0,i.kt)("p",null,"In case of AWS it is also required to assign proper permissions so\nthat Kraken can create or destroy EC2 instances. List of all requires\npermissions looks as follows:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "Version": "2012-10-17",\n    "Statement": [\n        {\n            "Sid": "VisualEditor0",\n            "Effect": "Allow",\n            "Action": [\n                "ec2:AuthorizeSecurityGroupIngress",\n                "ec2:CreateKeyPair",\n                "ec2:CreateSecurityGroup",\n                "ec2:CreateTags",\n                "ec2:DeleteKeyPair",\n                "ec2:DescribeInstances",\n                "ec2:DescribeInstanceStatus"\n                "ec2:DescribeInstanceTypeOfferings",\n                "ec2:DescribeRegions",\n                "ec2:DescribeSecurityGroups",\n                "ec2:DescribeVpcs",\n                "ec2:RunInstances",\n                "ec2:TerminateInstances",\n            ],\n            "Resource": "*"\n        }\n    ]\n}\n')),(0,i.kt)("h2",{id:"configuration-in-agents-groups"},"Configuration in Agents Groups"),(0,i.kt)("p",null,"Having set credentials to cloud providers, it is possible now to\nconfigure aspects of spawning new machines. This can be done on Kraken\n-> Agents -> Groups page.  When a particular group is selected, then\nits details will be presented on a separate tab. On this tab, there is\na section ",(0,i.kt)("inlineCode",{parentName:"p"},"Agents Deployment"),". So the deployment can be manual\n(default) or automated to particular cloud provider. In the case of\nAmazon Web Services, there are the following options that can be set:"),(0,i.kt)(o.Z,{img:"screen-agents-groups-cloud-aws.png",mdxType:"Screen"}),(0,i.kt)("p",null,"The meaning of the settings is as follows."),(0,i.kt)("p",null,"In ",(0,i.kt)("strong",{parentName:"p"},"General")," section:"),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Region")," - AWS region where a machine will be spawned"),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Instances Limit")," - maximum number of spawned machines at a time"),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Default AMI Image")," - if AMI image is not provided in job definition\nthat this one is used"),(0,i.kt)("p",null,"In ",(0,i.kt)("strong",{parentName:"p"},"VM Options")," section:"),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Instance Type")," - EC2 instance type that should be used for spawned\nmachines, the full list is available on ",(0,i.kt)("a",{parentName:"p",href:"https://aws.amazon.com/ec2/instance-types/"},"AWS web\npage")),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Spot Instance")," - indicates where Spot instance should be used (",(0,i.kt)("a",{parentName:"p",href:"https://aws.amazon.com/ec2/spot/"},"AWS\ndocs"),")"),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Monitoring")," - indicates if monitoring should be enabled (",(0,i.kt)("a",{parentName:"p",href:"https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/using-cloudwatch-new.html"},"AWS\ndocs"),")"),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"CPU Credits Unlimited")," - this allows having more burst power, more\nin ",(0,i.kt)("a",{parentName:"p",href:"https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/burstable-performance-instances-unlimited-mode.html"},"AWS\ndocs")),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Init Script")," - a value of this text is passed as UserData to EC2\ninstance, generally, this is a script that is executing during the\nfirst boot of instance (",(0,i.kt)("a",{parentName:"p",href:"https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/user-data.html"},"AWS docs"),")"),(0,i.kt)("p",null,"In ",(0,i.kt)("strong",{parentName:"p"},"Destruction")," section:"),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Destroy VM after N jobs")," - this indicates that the machine should\nbe destroyed (terminated) after it is used in N Kraken jobs, default\nis 1, ie. machine is used once and then it is destroyed so each time\na new fresh machine is used for each job; 0 means that this\nmechanism is disabled"),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Destroy VM after N minutes of idle time")," - this indicates that the\nmachine should be destroyed (terminated) after it is not used in any\nKraken jobs for a given number of minutes, default is 10 minutes,\nie. a machine is destroyed if it sits idle for 10 minutes; 0 means\nthat this mechanism is disabled"),(0,i.kt)("h2",{id:"usage"},"Usage"),(0,i.kt)("p",null,"Now when a job is assigned to an agents group with configured Agents\nDeployment then a new machine will be spawned for that job if there\nare no available agents."))}m.isMDXComponent=!0}}]);