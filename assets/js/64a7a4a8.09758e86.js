"use strict";(self.webpackChunkkraken_ci_website=self.webpackChunkkraken_ci_website||[]).push([[1633],{7521:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>o,contentTitle:()=>r,default:()=>h,frontMatter:()=>a,metadata:()=>l,toc:()=>c});var t=s(4848),i=s(8453);const a={id:"schema",title:"Workflow Schema"},r=void 0,l={id:"schema",title:"Workflow Schema",description:"This chapter presents syntax of a workflow schema defined in stages of a",source:"@site/docs/schema.md",sourceDirName:".",slug:"/schema",permalink:"/docs/schema",draft:!1,unlisted:!1,editUrl:"https://github.com/kraken-ci/website/edit/master/docs/schema.md",tags:[],version:"current",frontMatter:{id:"schema",title:"Workflow Schema"},sidebar:"someSidebar",previous:{title:"Stages in a Branch",permalink:"/docs/stages"},next:{title:"Data in Schema",permalink:"/docs/schema-data"}},o={},c=[{value:"Overview",id:"overview",level:2},{value:"Schema Elements",id:"schema-elements",level:2},{value:"Parent",id:"parent",level:2},{value:"Triggers",id:"triggers",level:2},{value:"parent",id:"parent-1",level:3},{value:"interval",id:"interval",level:3},{value:"date",id:"date",level:3},{value:"cron",id:"cron",level:3},{value:"repo",id:"repo",level:3},{value:"manual",id:"manual",level:3},{value:"Parameters",id:"parameters",level:2},{value:"Configs",id:"configs",level:2},{value:"Flow Label",id:"flow-label",level:2},{value:"Run Label",id:"run-label",level:2},{value:"Jobs",id:"jobs",level:2},{value:"Name",id:"name",level:3},{value:"Timeout",id:"timeout",level:3},{value:"Steps in Job",id:"steps-in-job",level:2},{value:"Conditional Steps",id:"conditional-steps",level:2},{value:"Example 1",id:"example-1",level:4},{value:"Example 2",id:"example-2",level:4},{value:"Built-in Step Tools",id:"built-in-step-tools",level:2},{value:"Shell",id:"shell",level:3},{value:"Shell: Hello World",id:"shell-hello-world",level:4},{value:"Git",id:"git",level:3},{value:"Artifacts",id:"artifacts",level:3},{value:"Cache",id:"cache",level:3},{value:"Data",id:"data",level:3},{value:"Data Example 1",id:"data-example-1",level:4},{value:"Data Example 2",id:"data-example-2",level:4},{value:"Data Example 3",id:"data-example-3",level:4},{value:"Data Example 4",id:"data-example-4",level:4},{value:"Pylint",id:"pylint",level:3},{value:"Pytest",id:"pytest",level:3},{value:"Junit Collect",id:"junit-collect",level:3},{value:"Go Test",id:"go-test",level:3},{value:"NgLint",id:"nglint",level:3},{value:"Cloc",id:"cloc",level:3},{value:"RndTest",id:"rndtest",level:3},{value:"Custom Tools",id:"custom-tools",level:3},{value:"Environment in Job",id:"environment-in-job",level:2},{value:"Agents Groups",id:"agents-groups",level:3},{value:"Executors",id:"executors",level:3},{value:"Systems",id:"systems",level:3},{value:"Notification",id:"notification",level:2},{value:"Email",id:"email",level:3},{value:"Slack",id:"slack",level:3},{value:"Discord",id:"discord",level:3},{value:"GitHub",id:"github",level:3}];function d(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",h4:"h4",li:"li",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.p,{children:"This chapter presents syntax of a workflow schema defined in stages of a\nbranch."}),"\n",(0,t.jsxs)(n.p,{children:["Full schema syntax referenced is available in ",(0,t.jsx)(n.a,{href:"schema-ref",children:"schema reference"}),"."]}),"\n",(0,t.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,t.jsx)(n.p,{children:"The workflow schema attached to a stage is defined in the Python\nlanguage."}),"\n",(0,t.jsx)(n.p,{children:"Example:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'def stage(ctx):\n    return {\n        "parent": "root",\n        "triggers": {\n            "interval": "10m",\n        },\n        "parameters": [],\n        "flow_label": "demo-#{flow.seq.shared}",\n        "jobs": [{\n            "name": "test",\n            "steps": [{\n                "tool": "git",\n                "checkout": "https://github.com/frankhjung/python-helloworld.git",\n                "branch": "master"\n            }, {\n                "tool": "pytest",\n                "params": "tests/testhelloworld.py",\n                "cwd": "python-helloworld"\n            }],\n            "environments": [{\n                "system": "ubuntu-18.04",\n                "agents_group": "all",\n                "config": "default"\n            }]\n        }],\n        "notification": {\n            "slack": {"channel": "kk-results"},\n            "email": "godfryd@gmail.com"\n        }\n    }\n'})}),"\n",(0,t.jsxs)(n.p,{children:["The workflow is defined in a ",(0,t.jsx)(n.code,{children:"stage"})," function. Its code imperatively\ndefines various elements of the schema. These elements, such as\n",(0,t.jsx)(n.code,{children:"triggers"})," or ",(0,t.jsx)(n.code,{children:"jobs"}),", are described in\nthe ",(0,t.jsx)(n.a,{href:"#schema-elements",children:"Schema Elements"})," section below."]}),"\n",(0,t.jsxs)(n.p,{children:["What is essential from a high-level perspective is that the schema is\ndynamically defined. However, ultimately, what is executed is\ndeclarative. The ",(0,t.jsx)(n.code,{children:"stage"})," function describes which ",(0,t.jsx)(n.code,{children:"jobs"})," must be\nexecuted, in which ",(0,t.jsx)(n.code,{children:"environments"}),", the ",(0,t.jsx)(n.code,{children:"parent"})," stage, and so on. All\nof these can be dynamically described, and then the schema declaration\nis remembered and executed at the appropriate time. This is in\ncontrast to Jenkins, where the pipeline code defined in a Jenkinsfile\nis executed only when a job is executed. In Kraken, stage Python code\ncan be executed at any time. The result of the execution of the stage\ncode is a schema declaration that can be executed later.  This way,\nwhen the stage code is saved in Kraken UI, it is immediately executed,\nand the generated schema is validated to ensure correctness. There is\nno need to execute a job to determine if the syntax is correct. In the\ncase of Jenkins, the user only learns about Jenkinsfile issues during\nits execution."]}),"\n",(0,t.jsx)(n.p,{children:"The stage code can be executed at any time and multiple times. It is\nexecuted as soon as it is saved and right before the schema is\ninstantiated and run by a Kraken Agent."}),"\n",(0,t.jsx)(n.h2,{id:"schema-elements",children:"Schema Elements"}),"\n",(0,t.jsx)(n.p,{children:"There are defined several things in the schema:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"parent"})," stage"]}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"triggers"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"parameters"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"configs"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"jobs"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"notification"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"timeout"})}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"parent",children:"Parent"}),"\n",(0,t.jsxs)(n.p,{children:["Parent allows for defining a chain of dependencies between subsequent\nstages. Current stage will be started only when parent stage has been\nfinished.  The value of ",(0,t.jsx)(n.code,{children:"parent"})," field is a name of a stage. If it is\nset to special value ",(0,t.jsx)(n.code,{children:"root"})," than it means that the stage does not\ndepend on anything and can be started as the first stage or one of the\nfirst stages, just after triggering a new flow in a branch."]}),"\n",(0,t.jsx)(n.h2,{id:"triggers",children:"Triggers"}),"\n",(0,t.jsxs)(n.p,{children:["Triggers indicate what events may start a stage and create its new\nrun.  There are several events: ",(0,t.jsx)(n.code,{children:"parent"}),", ",(0,t.jsx)(n.code,{children:"interval"}),", ",(0,t.jsx)(n.code,{children:"date"}),", ",(0,t.jsx)(n.code,{children:"cron"}),",\n",(0,t.jsx)(n.code,{children:"repo"})," and ",(0,t.jsx)(n.code,{children:"manual"}),"."]}),"\n",(0,t.jsxs)(n.p,{children:["Whole flow and its root stages can be also triggered manually in web UI or by a\nwebhook. More about that in ",(0,t.jsx)(n.a,{href:"/docs/webhooks",children:"Webhooks chapter"}),"."]}),"\n",(0,t.jsx)(n.h3,{id:"parent-1",children:"parent"}),"\n",(0,t.jsxs)(n.p,{children:["A stage is triggered by completion of a parent stage. It is defined as ",(0,t.jsx)(n.code,{children:'"parent": True'}),"."]}),"\n",(0,t.jsx)(n.p,{children:"Example:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'"triggers": {\n   "parent": True\n}\n'})}),"\n",(0,t.jsx)(n.h3,{id:"interval",children:"interval"}),"\n",(0,t.jsxs)(n.p,{children:["Given stage is triggered specified amount of time after competion of\nprevious run of this stage.  The duration can be specified in a human\nreadable way e.g. ",(0,t.jsx)(n.code,{children:"1d"})," what means one day or ",(0,t.jsx)(n.code,{children:"3h 30m"})," what means 3\nhours and 30 minutes."]}),"\n",(0,t.jsx)(n.p,{children:"Example, start a new stage run every 10 minutes:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'"triggers": {\n   "interval": "10m"\n}\n'})}),"\n",(0,t.jsx)(n.h3,{id:"date",children:"date"}),"\n",(0,t.jsxs)(n.p,{children:["Given stage is triggered once, on specified date. The date can be\nprovided in human readable way, e.g.: ",(0,t.jsx)(n.code,{children:"2012-01-19 17:21:00"})," or ",(0,t.jsx)(n.code,{children:"Sat Sep 17 23:26:08 CEST 2016"}),"."]}),"\n",(0,t.jsx)(n.p,{children:"Example, start a new stage run once on indicate date:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'"triggers": {\n   "date": "2012-01-19 17:21:00"\n}\n'})}),"\n",(0,t.jsx)(n.h3,{id:"cron",children:"cron"}),"\n",(0,t.jsxs)(n.p,{children:["A stage is triggered on specified CRON rule e.g. ",(0,t.jsx)(n.code,{children:"* * 10 * *"}),". There\nare always 5 items. Each item is separated by space. The items meaning\nare as follows: minutes, hours, days, months, dow (day of week).  The\npossible values for each item can be found on\n",(0,t.jsx)(n.a,{href:"https://apscheduler.readthedocs.io/en/stable/modules/triggers/cron.html?highlight=cron#introduction",children:"Advanced Python Scheduler web page"})]}),"\n",(0,t.jsx)(n.p,{children:"Example, start a new stage run always half past nine AM:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'"triggers": {\n   "cron": "30 9 * * *"\n}\n'})}),"\n",(0,t.jsx)(n.h3,{id:"repo",children:"repo"}),"\n",(0,t.jsx)(n.p,{children:"Example, start a new stage run when there are new commits in master\nbranch of Kraken's repository; check for new commits every 60 minutes."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'"triggers": {\n    "repo": {\n        "url": "https://github.com/Kraken-CI/kraken/",\n        "branch": "master",\n        "interval": "60m"\n    }\n}\n'})}),"\n",(0,t.jsx)(n.p,{children:"Trigger build if there is a new commit to master branch in Kraken repo.\nCheck the repo every 60 minutes."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'"triggers": {\n    "repo": {\n        "repos": [{\n            "url": "https://github.com/Kraken-CI/kraken/",\n            "branch": "master"\n        }, {\n            "url": "https://github.com/Kraken-CI/website/",\n            "branch": "master"\n        }],\n        "interval": "60s"\n        "git_cfg": {\n            "http.proxy": "https://my-proxy.example.com:8080"\n        }\n    }\n}\n'})}),"\n",(0,t.jsx)(n.p,{children:"Trigger build if there is a new commit to master branch in any of two\nindicated repos.  Check the repo every 60 seconds. In clone operation\nset indicated HTTP proxy in Git config."}),"\n",(0,t.jsxs)(n.p,{children:["There is another way of trigger a run based on changes to a repository.\nCheck ",(0,t.jsx)(n.a,{href:"webhooks",children:"webhooks"})," chapter for details."]}),"\n",(0,t.jsx)(n.h3,{id:"manual",children:"manual"}),"\n",(0,t.jsxs)(n.p,{children:["Stage may be configured in a way that it is not automatically started,\neven if its parent has completed. This can be achieved by ",(0,t.jsx)(n.code,{children:"manual"}),"\ntrigger. When it is set to ",(0,t.jsx)(n.code,{children:"True"})," then in a web UI its run is shown in\nblue and awaits user confirmation to start."]}),"\n",(0,t.jsx)(n.p,{children:"Example:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'"triggers": {\n    "manual": True\n}\n'})}),"\n",(0,t.jsx)(n.h2,{id:"parameters",children:"Parameters"}),"\n",(0,t.jsx)(n.p,{children:"When a flow is started manually it is possible to provide values for\nparameters defined in all stages in given branch. This allows for\ncustomizing behaviour of a stage and its jobs."}),"\n",(0,t.jsx)(n.p,{children:"There can be defined multiple parameters in one stage. Each parameters\nhas the following fields:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"name"})," - a string that identifies a parameter"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"type"})," - a type of parameter, for now it can be only ",(0,t.jsx)(n.code,{children:"string"})]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"default"})," - a default value for a parameter, it is required"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"description"})," - a description of a parameter, it used when a\nparameter is presented in web UI"]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Default value for a parameter is required. It is used when a flow is\nstarted automatically. In that situation it is not possible to provide\nvalues for the parameters manually."}),"\n",(0,t.jsx)(n.p,{children:"Example:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'"parameters": [{\n    "name": "count",\n    "type": "string",\n    "default": "10",\n    "description": "Number of tests to generate"\n}]\n'})}),"\n",(0,t.jsxs)(n.p,{children:["Then, in a job definition a parameter can be used by enclosing its\nname in ",(0,t.jsx)(n.code,{children:"#{...}"}),", e.g.: ",(0,t.jsx)(n.code,{children:"#{args.count}"}),"."]}),"\n",(0,t.jsxs)(n.p,{children:["Using parameter ",(0,t.jsx)(n.code,{children:"COUNT"})," example:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'"jobs": [{\n    "name": "random tests",\n    "steps": [{\n        "tool": "rndtest",\n        "count": "#{args.count}"\n    }],\n}]\n'})}),"\n",(0,t.jsx)(n.p,{children:"or"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'"jobs": [{\n    "name": "random tests",\n    "steps": [{\n        "tool": "shell",\n        "cmd": "echo \'the count is #{args.count}\'"\n    }],\n    ...\n}]\n'})}),"\n",(0,t.jsxs)(n.p,{children:["More about interpolating variables in string can be found\nin ",(0,t.jsx)(n.a,{href:"schema-data",children:"Schema Data chapter"}),"."]}),"\n",(0,t.jsx)(n.h2,{id:"configs",children:"Configs"}),"\n",(0,t.jsx)(n.p,{children:"Not implemented yet."}),"\n",(0,t.jsx)(n.h2,{id:"flow-label",children:"Flow Label"}),"\n",(0,t.jsx)(n.p,{children:"This field allows for setting a custom label format for flows. It is\ndisplayed instead of flow database ID which is displayed by default."}),"\n",(0,t.jsx)(n.p,{children:"Example 1:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'"flow_label": "demo-#{flow.seq.shared}",\n'})}),"\n",(0,t.jsxs)(n.p,{children:["Here a value of ",(0,t.jsx)(n.code,{children:"flow.seq.shared"})," sequence is used. It mean that each\nnew flow will get its incremented numer, e.g. ",(0,t.jsx)(n.code,{children:"demo-2"}),". This\nsequence is shared between CI and DEV flows so the label is uniqe for\nboth types of flows."]}),"\n",(0,t.jsx)(n.p,{children:"Example 2:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'"flow_label": "bld-#{flow.seq.own}",\n'})}),"\n",(0,t.jsxs)(n.p,{children:["In this case a ",(0,t.jsx)(n.code,{children:"flow.seq.own"})," sequence is used. It means that\nthe sequence is incremented separately for CI and for DEV flows."]}),"\n",(0,t.jsxs)(n.p,{children:["More about sequences in ",(0,t.jsx)(n.a,{href:"schema-data",children:"Schema Data"}),"."]}),"\n",(0,t.jsx)(n.h2,{id:"run-label",children:"Run Label"}),"\n",(0,t.jsx)(n.p,{children:"This field allows for setting a custom label format for runs. It is\ndisplayed instead of run database ID which is displayed by default."}),"\n",(0,t.jsx)(n.p,{children:"Example 1:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'"run_label": "run.#{run.seq.own}",\n'})}),"\n",(0,t.jsxs)(n.p,{children:["In this case a ",(0,t.jsx)(n.code,{children:"run.seq.own"})," sequence is used. It means that\nthe sequence is incremented separately for CI and for DEV flows for\nthat run, e.g.: ",(0,t.jsx)(n.code,{children:"run.42"}),"."]}),"\n",(0,t.jsxs)(n.p,{children:["More about sequences in ",(0,t.jsx)(n.a,{href:"schema-data",children:"Schema Data"}),"."]}),"\n",(0,t.jsx)(n.h2,{id:"jobs",children:"Jobs"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"Jobs"})," describe what should be done in a ",(0,t.jsx)(n.code,{children:"stage"}),". A ",(0,t.jsx)(n.code,{children:"stage"})," can define\nmultiple ",(0,t.jsx)(n.code,{children:"jobs"})," and they all are run in parallel."]}),"\n",(0,t.jsx)(n.p,{children:"There are several setting fields in the job:"}),"\n",(0,t.jsx)(n.h3,{id:"name",children:"Name"}),"\n",(0,t.jsx)(n.p,{children:"A name of the job."}),"\n",(0,t.jsx)(n.p,{children:"Example:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'"jobs": [{\n    "name": "build",\n    ...\n}]\n'})}),"\n",(0,t.jsx)(n.h3,{id:"timeout",children:"Timeout"}),"\n",(0,t.jsx)(n.p,{children:"An initial timeout of the job. It is expressed in seconds."}),"\n",(0,t.jsx)(n.p,{children:"If there are more than 10 historical succeded jobs then timeout is\nestimated automatically."}),"\n",(0,t.jsx)(n.p,{children:"Example:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'"jobs": [{\n    "timeout": 1200,\n    ...\n}]\n'})}),"\n",(0,t.jsx)(n.p,{children:"Timeout is set to 1200 seconds, i.e. 20 minutes."}),"\n",(0,t.jsx)(n.h2,{id:"steps-in-job",children:"Steps in Job"}),"\n",(0,t.jsx)(n.p,{children:"The steps field of the job defines what an agent should execute. Each\nstep has an indicated tool that directly executes it. Steps are\nexecuted in the same order as they are defined."}),"\n",(0,t.jsx)(n.p,{children:"Common step fields:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"tool"})," - a tool name that is executing the step; this is required"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"cwd"})," - a current working directory where the step is executed; default is ",(0,t.jsx)(n.code,{children:"'.'"})]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"timeout"})," - a timeout in seconds that limits time of step execution; it is guareded by an agent; if it is exceeded then the step is arbitrarly terminated; it is optional - default value is 60 seconds"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"attempts"})," - a number of times the step is retried if if it returns error; default is 1"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"sleep_time_after_attempt"})," - a sleep time between subsequent execution attempts; default is 0"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"when"})," - a condition that indicates if a step should be executed or not, more in ",(0,t.jsx)(n.a,{href:"#conditional-steps",children:"Conditional Steps"})," section"]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Example:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'"jobs": [{\n    "steps": [{\n        "tool": "shell",\n        ...\n    }]\n}]\n'})}),"\n",(0,t.jsx)(n.h2,{id:"conditional-steps",children:"Conditional Steps"}),"\n",(0,t.jsxs)(n.p,{children:["It is possible to skip the execution of a step. This is controlled by\nthe ",(0,t.jsx)(n.code,{children:"when"})," field. The content of this field is a ",(0,t.jsx)(n.a,{href:"https://jinja.palletsprojects.com/en/3.1.x/templates/#expressions",children:"Jinja2"}),"\nexpression. The expression may refer to data that is described in ",(0,t.jsx)(n.a,{href:"/docs/schema-data",children:"Data in Schema"})," section.\nThere are a predefined values provided for this field:"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"prev_ok"})," - a step is executed when the previous step succeeded,"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"always"})," - a step is always executed,"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"never"})," - a step is never executed,"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"was_any_error"}),"- a step is executed if there was an error in any of previous steps,"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"was_no_error"}),"- a step is executed if there was no errors in all previous steps - this is the default condition,"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"is_ci"})," - a step is executed if this is a CI flow,"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"is_dev"})," - a step is executed if this is a DEV flow."]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["If the ",(0,t.jsx)(n.code,{children:"when"})," field is not defined, then the default value for the\ncondition is ",(0,t.jsx)(n.code,{children:"was_no_error"}),". This means that the step is executed only\nif all previous steps succeeded or were skipped."]}),"\n",(0,t.jsxs)(n.p,{children:["It is important to note that when the condition is just ",(0,t.jsx)(n.code,{children:"is_ci"})," (like\nin the example below), then it is run when the flow type is CI\nregardless of whether the previous steps succeeded or not. If we want\nto take into account the status of the previous steps, then the\ncondition should be: ",(0,t.jsx)(n.code,{children:"was_no_errors and is_ci"}),"."]}),"\n",(0,t.jsx)(n.h4,{id:"example-1",children:"Example 1"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'"jobs": [{\n    "steps": [{\n        "tool": "shell",\n        "when": "is_ci"\n        ...\n    }]\n}]\n'})}),"\n",(0,t.jsx)(n.p,{children:"Here, the step is executed only if this is a CI flow (ie. not a DEV flow)."}),"\n",(0,t.jsx)(n.h4,{id:"example-2",children:"Example 2"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'"jobs": [{\n    "steps": [{\n        "tool": "shell",\n        "when": "job.steps[step.index - 1].result.duration > 3"\n        ...\n    }]\n}]\n'})}),"\n",(0,t.jsxs)(n.p,{children:["This example demonstrates a more sophisticated expression in the\n",(0,t.jsx)(n.code,{children:"when"})," field. Here, the ",(0,t.jsx)(n.code,{children:"step"})," object is used along with its ",(0,t.jsx)(n.code,{children:"index"}),"\nfield, as well as the ",(0,t.jsx)(n.code,{children:"job"})," object. As a result, the expression checks\nif the duration of the previous step was longer than 3 seconds. If it\nis, then the step is executed; otherwise, it is skipped."]}),"\n",(0,t.jsxs)(n.p,{children:["More examples can be found at ",(0,t.jsx)(n.a,{href:"https://github.com/Kraken-CI/workflow-examples/tree/main/conditional-steps/one.py",children:"https://github.com/Kraken-CI/workflow-examples/tree/main/conditional-steps/one.py"}),"."]}),"\n",(0,t.jsx)(n.h2,{id:"built-in-step-tools",children:"Built-in Step Tools"}),"\n",(0,t.jsx)(n.h3,{id:"shell",children:"Shell"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"shell"})," is a tool that executes provided command in a shell."]}),"\n",(0,t.jsx)(n.p,{children:"Fields:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"cmd"})," - a command to execute"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"script"})," - or a script code to execute, this is multiline shell code"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"user"})," - this field allows for changing user e.g. to ",(0,t.jsx)(n.code,{children:"root"}),"; by default kraken ",(0,t.jsx)(n.code,{children:"user"})," is used"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"env"})," - a dictionary with environment variables and their values"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"background"})," - if set to True then a step is run in background; the\nbackground process will be terminated at the end of whole job;\ndefault value is False"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"shell_exe"})," - an alternative path or command to shell executable, e.g.: zsh or /usr/bin/fish"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"ssh-key"})," - a name of a secret that holds SSH username and key for ssh-agent"]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Examples:"}),"\n",(0,t.jsx)(n.h4,{id:"shell-hello-world",children:"Shell: Hello World"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'"steps": [{\n    "tool": "shell",\n    "cmd": "echo \'Hello World\'"\n}]\n'})}),"\n",(0,t.jsx)(n.p,{children:"Just say 'Hello World'."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'"steps": [{\n    "tool": "shell",\n    "cmd": "./run-build.sh",\n    "cwd": "/build",\n    "user": "root",\n    "env": {\n        "ARCH": "arm64"\n        "JOBS": "8"\n    },\n    "timeout": 1200,\n    "attempts": 3,\n    "sleep_time_after_attempt": 10\n}]\n'})}),"\n",(0,t.jsxs)(n.p,{children:["Run a build script in ",(0,t.jsx)(n.code,{children:"/build"})," folder as ",(0,t.jsx)(n.code,{children:"root"})," user. Pass two\nenvironment variables: ",(0,t.jsx)(n.code,{children:"ARCH"})," and ",(0,t.jsx)(n.code,{children:"JOBS"}),". The step should fit in 1200\nseconds ie. 20 minutes. If the commands returns non zero exit code\nthen it is repeated up to 3 times. There is a 10 seconds sleep time\nperiod between attempts."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'"steps": [{\n    "tool": "shell",\n    "cmd": "./run-service.sh",\n    "background": True\n}, {\n    "tool": "shell",\n    "cmd": "ps ax"\n}]\n'})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"run-service.sh"})," script is run in background and then the next step is\nexecuted. It should show a list of all processes - ",(0,t.jsx)(n.code,{children:"./run-service.sh"}),"\nshould be on the list."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'"steps": [{\n    "tool": "shell",\n    "script": """\n        echo \'ABC\'\n        echo \'DEF\'\n    """,\n}]\n'})}),"\n",(0,t.jsx)(n.p,{children:"Run a multiline script that contains several commands. It is stored as\na script file and executed."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'"steps": [{\n    "tool": "shell",\n    "cmd": "ls -al",\n    "shell_exe": "zsh"\n}]\n'})}),"\n",(0,t.jsxs)(n.p,{children:["Here, instead of ",(0,t.jsx)(n.code,{children:"/bin/sh"}),", ",(0,t.jsx)(n.code,{children:"zsh"})," is used as shell executable."]}),"\n",(0,t.jsxs)(n.p,{children:["More examples can be found at ",(0,t.jsx)(n.a,{href:"https://github.com/Kraken-CI/workflow-examples/tree/main/shell",children:"https://github.com/Kraken-CI/workflow-examples/tree/main/shell"}),"."]}),"\n",(0,t.jsx)(n.h3,{id:"git",children:"Git"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"git"})," is a tool that allows for checking out a Git repository. It clones a\nrepository indicated by an URK in ",(0,t.jsx)(n.code,{children:"checkout"})," field and puts it in\n",(0,t.jsx)(n.code,{children:"destination"})," folder. It also stores Git repository bundle in Kraken\nglobal storage for quiecker subsequent retrieval. If URL is using SSH\nprotocol and ",(0,t.jsx)(n.code,{children:"ssh-key"})," field is set then it is used by ssh-agent for\npassing a key during Git cloning. If ",(0,t.jsx)(n.code,{children:"access-token"})," is provided than\nit is embedded to URL in git clone instruction (see\n",(0,t.jsx)(n.a,{href:"https://docs.gitlab.com/ee/user/project/deploy_tokens/#git-clone-a-repository",children:"GitLab use case"}),")."]}),"\n",(0,t.jsx)(n.p,{children:"Fields:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"checkout"})," - an URL to the repository"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"branch"})," - a branch to checkout, ",(0,t.jsx)(n.code,{children:"master"})," is default"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"destination"})," - a destination folder for the repository; it is optional"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"ssh-key"})," - a name of a secret that holds SSH username and key for ssh-agent"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"access-token"})," - a name of a secret that contains an access token for GitLab or GitHub"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"git_cfg"})," - a dictionary with Git config that is passed to -c of the clone command"]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Example:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'"steps": [{\n    "tool": "git",\n    "checkout": "https://github.com/Kraken-CI/kraken.git",\n    "branch": "master"\n}]\n'})}),"\n",(0,t.jsxs)(n.p,{children:["This clones ",(0,t.jsx)(n.a,{href:"https://github.com/Kraken-CI/kraken.git",children:"https://github.com/Kraken-CI/kraken.git"})," and checks out master branch."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'"steps": [{\n    "tool": "git",\n    "checkout": "https://github.com/Kraken-CI/kraken.git",\n    "branch": "master",\n    "git_cfg": {\n        "http.proxy": "https://my-proxy.example.com:8080"\n    }\n}]\n'})}),"\n",(0,t.jsx)(n.p,{children:"More examples can be found at TODO."}),"\n",(0,t.jsx)(n.h3,{id:"artifacts",children:"Artifacts"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"artifacts"})," is a tool that allows for storing and retrieving artifacts in Kraken\nglobal ",(0,t.jsx)(n.a,{href:"storage",children:"storage"}),". They can be non public so they are only\navailable internally in Kraken to other stages but only in the same\nflow. If they are public then they are also presented in web UI and\ncan be downloaded by users."]}),"\n",(0,t.jsx)(n.p,{children:"Fields:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"action"})," - an action that artifacts tool should execute: either\n",(0,t.jsx)(n.code,{children:"download"})," or ",(0,t.jsx)(n.code,{children:"upload"}),". ",(0,t.jsx)(n.code,{children:"upload"})," is default action"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"public"})," - determines if artifacts should be public and available to\nusers in web UI (",(0,t.jsx)(n.code,{children:"True"}),") or if they should be only accessible\ninternally to other stages but only in the same flow (",(0,t.jsx)(n.code,{children:"False"}),");\ndefault value is ",(0,t.jsx)(n.code,{children:"False"})]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"source"})," - a path or list of paths that should be archived or\nretreived. A path can indicate a folder or a file; a path, in case\nof upload action, can contain globbing signs ",(0,t.jsx)(n.code,{children:"*"})," or ",(0,t.jsx)(n.code,{children:"**"}),"; a path can\nbe relative or absolute"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"destination"})," - a path were the artifact(s) should be stored; in\ncase of download action, if the destination folder does not exist\nthen it is created; by default it is ",(0,t.jsx)(n.code,{children:"'.'"})]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"report_entry"})," - a destination path of one of uploaded HTML files\nthat will be used as a report entry in Kraken Web UI, on a flow\npage and a run page"]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Example:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'"steps": [{\n    "tool": "artifacts",\n    "source": "a.txt"\n}]\n'})}),"\n",(0,t.jsxs)(n.p,{children:["Default action is upload so here an ",(0,t.jsx)(n.code,{children:"a.txt"})," file will be stored in\nglobal storage in root folder which is default."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'"steps": [{\n    "tool": "artifacts",\n    "action": "download",\n    "source": "a.txt",\n    "destination": \'a/b/c"\n}]\n'})}),"\n",(0,t.jsxs)(n.p,{children:["Here an ",(0,t.jsx)(n.code,{children:"a.txt"})," file is downloaded from global storage. It is saved to\n",(0,t.jsx)(n.code,{children:"a/b/c"})," folder. If it does not exist then it is created first."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'"steps": [{\n    "tool": "artifacts",\n    "source": ["index.html", "log.html"],\n    "report_entry": "index.html"\n}]\n'})}),"\n",(0,t.jsxs)(n.p,{children:["In this example a generated report is uploaded to Kraken's\nstorage. The report consists of two files: index.html and log.html.\n",(0,t.jsx)(n.code,{children:"report_entry"})," fields indicates which files should be used as a report\nentry. The report is available on a flow page and on a run page under\n",(0,t.jsx)(n.code,{children:"Reports"})," tab."]}),"\n",(0,t.jsxs)(n.p,{children:["More examples can be found at ",(0,t.jsx)(n.a,{href:"https://github.com/Kraken-CI/workflow-examples/tree/main/artifacts",children:"https://github.com/Kraken-CI/workflow-examples/tree/main/artifacts"}),"\nand ",(0,t.jsx)(n.a,{href:"https://github.com/Kraken-CI/workflow-examples/tree/main/reports",children:"https://github.com/Kraken-CI/workflow-examples/tree/main/reports"}),"."]}),"\n",(0,t.jsx)(n.h3,{id:"cache",children:"Cache"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"cache"})," is a tool that allows for caching files. It quite often\nhappens that during a build there are some dependencies that are\ndownloaded from an external source over a network. Sometime there is\nlots of content to download or the network link is quite slow so in\neffect downloading this content may take significant amount of time.\nTo speed this process it is possible to cache these files after\ndownloading them. In the following build these files are first\nretrieved from cache and then they are updated only if needed."]}),"\n",(0,t.jsxs)(n.p,{children:["So cache tool exposes two actions: ",(0,t.jsx)(n.code,{children:"save"})," and ",(0,t.jsx)(n.code,{children:"restore"}),". Cached files\nare stored under indicted key in Kraken global storage. This key can\nbe statically set so the content is always the same. The key can be\nalso set dynamically based on some variables e.g. repository branch or\nCI/DEV flow kind."]}),"\n",(0,t.jsx)(n.p,{children:"Fields:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"action"})," - an action that the tool should perform; it should be either ",(0,t.jsx)(n.code,{children:"store"})," or ",(0,t.jsx)(n.code,{children:"restore"})]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"key"})," - a key under which files are stored in or restored from cache"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"keys"})," - a list of key under which files are restored from cache"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"paths"})," - source paths used in ",(0,t.jsx)(n.code,{children:"store"})," action"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"expiry"})," - not implemented yet"]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Example:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'"steps": [{\n    "tool": "cache",\n    "action": "save",\n    "key": "one-key",\n    "paths": [\n         "abc"\n    ]\n}]\n'})}),"\n",(0,t.jsxs)(n.p,{children:["Store all files from ",(0,t.jsx)(n.code,{children:"abc"})," folder in cache under ",(0,t.jsx)(n.code,{children:"one-key"})," key."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'"steps": [{\n    "tool": "cache",\n    "action": "restore",\n    "keys": ["one-key"]\n}]\n'})}),"\n",(0,t.jsxs)(n.p,{children:["Restore all files under ",(0,t.jsx)(n.code,{children:"one-key"})," key in cache to ",(0,t.jsx)(n.code,{children:"abc"})," folder (the\ndestination folder was remembered during ",(0,t.jsx)(n.code,{children:"store"})," action)."]}),"\n",(0,t.jsxs)(n.p,{children:["More examples can be found at ",(0,t.jsx)(n.a,{href:"https://github.com/Kraken-CI/workflow-examples/tree/main/cache",children:"https://github.com/Kraken-CI/workflow-examples/tree/main/cache"}),"."]}),"\n",(0,t.jsx)(n.h3,{id:"data",children:"Data"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"data"})," is a tool that allows for storing and retrieving data in JSON\nformat on the server-side. The data can be attached to various\nentities:"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"current flow,"}),"\n",(0,t.jsx)(n.li,{children:"current branch - separatelly for CI flows, for DEV flows and\ncommon for both types of flows,"}),"\n",(0,t.jsx)(n.li,{children:"current project"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"This means that if data is stored in the current flow, then it is not\naccessible in the following flow. It is only available to runs and\njobs in the current flow. However, if it is stored at the branch\nlevel, then it is preserved between flows. Similarly, in the case of a\nproject, such data is available across all branches in the given\nproject."}),"\n",(0,t.jsx)(n.p,{children:"Fields:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"file"})," - a file containing data in JSON format for ",(0,t.jsx)(n.code,{children:"set"})," and\n",(0,t.jsx)(n.code,{children:"jsonpatch"})," operations, and JQ expression for ",(0,t.jsx)(n.code,{children:"jq"})," operation."]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"cwd"})," - the current working directory where the step is executed"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"value"})," - the same data as in file field but provided\ndirectly; alternative to the file field"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"operation"})," - an operation to be performed:"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"set"})," sets (and also overrides) data,"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"jq"})," executes a JQ\n",(0,t.jsx)(n.a,{href:"https://stedolan.github.io/jq/manual/#Assignment",children:"assignment expression"}),"\non the server-side data,"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"jsonpatch"})," patches server-side data as described on\n",(0,t.jsx)(n.a,{href:"https://jsonpatch.com/",children:"jsonpatch.com"}),", more details available on\n",(0,t.jsx)(n.a,{href:"https://www.rfc-editor.org/rfc/rfc6902",children:"RFC 6902"}),";"]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["by default it is ",(0,t.jsx)(n.code,{children:"set"})]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"json_pointer"})," - a JSON pointer that indicates the data location\n(see ",(0,t.jsx)(n.a,{href:"https://www.rfc-editor.org/rfc/rfc6901",children:"RFC 6901"}),");\nif the pointer is ",(0,t.jsx)(n.code,{children:"/"}),", then the entire data is taken, if a key name is provided, then\nthe data under this key is taken; the default value is ",(0,t.jsx)(n.code,{children:"/"})]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"scope"})," - a scope of data:"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"flow"})," - data attached to a flow,"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"branch-ci"})," - data attached to a branch related to CI flows,"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"branch-dev"})," - data attached to a branch related to Dev flows,"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"branch"})," - data attached to a branch,"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"project"})," - data attached to a project;"]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"flow"})," is the default value"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"The stored data can be used in two ways:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["by accessing the schema context, see ",(0,t.jsx)(n.a,{href:"schema-data#context",children:"Schema Data chapter, Context section"}),","]}),"\n",(0,t.jsxs)(n.li,{children:["by interpolating schema variables, see ",(0,t.jsx)(n.a,{href:"schema-data#interpolation",children:"Schema Data chapter, Interpolation section"}),"."]}),"\n"]}),"\n",(0,t.jsx)(n.h4,{id:"data-example-1",children:"Data Example 1"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'"steps": [{\n    "tool": "data",\n    "value": \'{"aaa": "bbb"}\'\n}]\n'})}),"\n",(0,t.jsx)(n.p,{children:"JSON data that is directly indicated in the value field will be stored\non the server-side in the flow scope."}),"\n",(0,t.jsx)(n.h4,{id:"data-example-2",children:"Data Example 2"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'"steps": [{\n    "tool": "data",\n    "file": "generated-data.json",\n    "operation": "set",\n    "json_pointer": "/generated-data",\n    "scope": "branch"\n}]\n'})}),"\n",(0,t.jsxs)(n.p,{children:["The JSON data stored in the ",(0,t.jsx)(n.code,{children:"generated-data.json"})," file will be saved\non the server-side within the branch scope, under the ",(0,t.jsx)(n.code,{children:"generated-data"}),"\nkey. Therefore, the data will be displayed as follows:\n",(0,t.jsx)(n.code,{children:'{"generated-data": <data from generated-data.json file>}'}),"."]}),"\n",(0,t.jsx)(n.h4,{id:"data-example-3",children:"Data Example 3"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'"steps": [{\n    "tool": "data",\n    "value": "\'.counter += 1",\n    "operation": "jq",\n    "scope": "branch-ci"\n}]\n'})}),"\n",(0,t.jsx)(n.p,{children:"A counter that is stored in data attached to the branch CI scope will\nbe incremented using a JQ assignment expression. During the first\nexecution, when there is no data on the server-side, the entire path\nto the indicated field in the JSON data will be created and its value\nwill be assumed to be 0. Therefore, after executing this expression\nfor the first time, the counter will be set to 1."}),"\n",(0,t.jsx)(n.h4,{id:"data-example-4",children:"Data Example 4"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'"steps": [{\n    "tool": "data",\n    "value": \'[{"op": "add", "path": "/foo", "value": "bar"}]\',\n    "operation": "jsonpatch",\n    "scope": "project"\n}]\n'})}),"\n",(0,t.jsxs)(n.p,{children:["If the data attached to a project was ",(0,t.jsx)(n.code,{children:'{"aaa": "bbb"}'}),", then after the\nexecution of this step, it will be updated to ",(0,t.jsx)(n.code,{children:'{"aaa": "bbb", "foo": "bar"}'}),". The step utilizes a JSON Patch expression that adds the\nspecified value under the specified path."]}),"\n",(0,t.jsxs)(n.p,{children:["More examples can be found on the following GitHub page:\n",(0,t.jsx)(n.a,{href:"https://github.com/Kraken-CI/workflow-examples/tree/main/dynamic-schema",children:"https://github.com/Kraken-CI/workflow-examples/tree/main/dynamic-schema"}),"."]}),"\n",(0,t.jsx)(n.h3,{id:"pylint",children:"Pylint"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"pylint"})," is a tool that allows for static analysis of Python source\ncode. It wraps around ",(0,t.jsx)(n.a,{href:"https://www.pylint.org/",children:"Pylint"}),"."]}),"\n",(0,t.jsx)(n.p,{children:"Fields:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"pylint_exe"})," - an alternative path or command to pylint, by default this is ",(0,t.jsx)(n.code,{children:"pylint"})]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"rcfile"})," - a path to pylint rcfile"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"modules_or_packages"})," - a path or paths to Python modules or packages that should be checked"]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Example:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'"steps": [{\n    "tool": "pylint",\n    "rcfile": "pylint.rc",\n    "modules_or_packages": "agent/kraken/agent"\n}]\n'})}),"\n",(0,t.jsxs)(n.p,{children:["Run ",(0,t.jsx)(n.code,{children:"pylint"})," on a package located in ",(0,t.jsx)(n.code,{children:"agent/kraken/agent"})," folder using\nrcfile ",(0,t.jsx)(n.code,{children:"pylint.rc"})," from current working directory."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'"steps": [{\n    "tool": "pylint",\n    "pylint_exe": "poetry run pylint",\n    "rcfile": "../pylint.rc",\n    "modules_or_packages": "kraken/server",\n    "cwd": "kraken/server"\n}]\n'})}),"\n",(0,t.jsxs)(n.p,{children:["Run ",(0,t.jsx)(n.code,{children:"pylint"})," but using specific command ie. ",(0,t.jsx)(n.code,{children:"poetry run pylint"})," on a\npackage located in ",(0,t.jsx)(n.code,{children:"kraken/server"})," folder using rcfile from\n",(0,t.jsx)(n.code,{children:"../pylint.rc"})," from indicated working directory ",(0,t.jsx)(n.code,{children:"kraken/server"}),"."]}),"\n",(0,t.jsx)(n.h3,{id:"pytest",children:"Pytest"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"pytest"})," is a tool that allows for running Python tests. It wraps\naround ",(0,t.jsx)(n.a,{href:"https://pytest.org/",children:"pytest"}),". It first collects list of all\navailable test cases based on passed parameters, then executes them\none by one, reporting results after each test case."]}),"\n",(0,t.jsx)(n.p,{children:"Fields:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"pytest_exe"})," -an alternative path or command to pytest, by default this is ",(0,t.jsx)(n.code,{children:"pytest-3"})]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"params"})," - parameters passed directly to pytest executable"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"pythonpath"})," - extra paths that are used by Python to look for modules/packages that it wants to load"]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Example:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'"steps": [{\n    "tool": "pytest",\n    "cwd": "kraken/agent"\n}]\n'})}),"\n",(0,t.jsxs)(n.p,{children:["Run pytest in ",(0,t.jsx)(n.code,{children:"kraken/agent"})," folder."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'"steps": [{\n    "tool": "pytest",\n    "pytest_exe": "poetry run pytest",\n    "params": "-vv -m \'not db\'",\n    "cwd": "kraken/server"\n}]\n'})}),"\n",(0,t.jsxs)(n.p,{children:["Run pytest in ",(0,t.jsx)(n.code,{children:"kraken/agent"})," folder, using specific command ",(0,t.jsx)(n.code,{children:"poetry run pytest"})," and passing to it ",(0,t.jsx)(n.code,{children:"-vv -m 'not db'"})," parameters."]}),"\n",(0,t.jsx)(n.h3,{id:"junit-collect",children:"Junit Collect"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"junit_collect"})," is a tool that allows for collecting test results\nstored in indicated files in the XML ",(0,t.jsx)(n.a,{href:"https://junit.org/",children:"JUnit"}),"\nformat."]}),"\n",(0,t.jsx)(n.p,{children:"Fields:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"file_glob"})," - a glob pattern for searching test result files"]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Example:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'"steps": [{\n    "tool": "junit_collect",\n    "file_glob": "**/test-results/test/*.xml"\n}]\n'})}),"\n",(0,t.jsxs)(n.p,{children:["More examples can be found at ",(0,t.jsx)(n.a,{href:"https://github.com/Kraken-CI/workflow-examples/tree/main/real-projects/lucene-solr",children:"https://github.com/Kraken-CI/workflow-examples/tree/main/real-projects/lucene-solr"}),"."]}),"\n",(0,t.jsx)(n.h3,{id:"go-test",children:"Go Test"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"gotest"})," is a tool that allows for\nrunning ",(0,t.jsx)(n.a,{href:"https://golang.org/",children:"Go language"})," tests."]}),"\n",(0,t.jsx)(n.p,{children:"Fields:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"go_exe"})," - an alternative path or command to ",(0,t.jsx)(n.code,{children:"go"})]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"params"})," - parameters passed directly to ",(0,t.jsx)(n.code,{children:"go test"})]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Example:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'"steps": [{\n    "tool": "gotest",\n    "cwd": "hugo",\n    "params": "-p 1 ./..."\n}]\n'})}),"\n",(0,t.jsxs)(n.p,{children:["Run Go tests in ",(0,t.jsx)(n.code,{children:"hugo"})," folder with special parameters ",(0,t.jsx)(n.code,{children:"-p 1 ./..."}),"."]}),"\n",(0,t.jsxs)(n.p,{children:["More examples can be found at ",(0,t.jsx)(n.a,{href:"https://github.com/Kraken-CI/workflow-examples/tree/main/real-projects/hugo",children:"https://github.com/Kraken-CI/workflow-examples/tree/main/real-projects/hugo"}),"."]}),"\n",(0,t.jsx)(n.h3,{id:"nglint",children:"NgLint"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"nglint"})," is a tool that allows for\nrunning ",(0,t.jsx)(n.a,{href:"https://angular.io/",children:"Angular"})," ",(0,t.jsx)(n.code,{children:"ng lint"}),", that is performing\nstatic analysis of TypeScript in Angular projects."]}),"\n",(0,t.jsx)(n.p,{children:"It does not have specific fields."}),"\n",(0,t.jsx)(n.p,{children:"Example:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'"steps": [{\n    "tool": "nglint",\n    "cwd": "kraken/ui"\n}]\n'})}),"\n",(0,t.jsxs)(n.p,{children:["Run ",(0,t.jsx)(n.code,{children:"ng lint"})," in ",(0,t.jsx)(n.code,{children:"kraken/ui"})," where is Angular project located."]}),"\n",(0,t.jsx)(n.h3,{id:"cloc",children:"Cloc"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"cloc"})," is a tool that allows for running counting lines of code. It\nwraps around ",(0,t.jsx)(n.a,{href:"http://github.com/AlDanial/cloc",children:"cloc"})," that can analyse\nsource code in multiple programming languages."]}),"\n",(0,t.jsx)(n.p,{children:"Fields:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"not-match-f"})," - the value is passed to ",(0,t.jsx)(n.code,{children:"--not-match-f=<regex>"})," that\nallows for filtering out indicated files"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"exclude-dir"})," - the value is passed to ",(0,t.jsx)(n.code,{children:"--exclude-dir=<D1>[,D2,]"})," that\nallows for excluding indicated list of directories"]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Example:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'"steps": [{\n    "tool": "cloc",\n    "not-match-f": "(package-lock.json|pylint.rc)",\n    "exclude-dir": "docker-elk",\n    "cwd": "kraken"\n}]\n'})}),"\n",(0,t.jsxs)(n.p,{children:["Run ",(0,t.jsx)(n.code,{children:"cloc"})," in ",(0,t.jsx)(n.code,{children:"kraken"})," folder. Exclude ",(0,t.jsx)(n.code,{children:"docker-elk"})," folder and filter\nout indicated two files."]}),"\n",(0,t.jsx)(n.h3,{id:"rndtest",children:"RndTest"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"rndtest"})," is a tool that allows for generating random test case\nresults. It is used in Kraken to test its testing and reporting\ncapabilities."]}),"\n",(0,t.jsx)(n.p,{children:"Fields:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"count"})," - a number of expected test cases"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"custom-tools",children:"Custom Tools"}),"\n",(0,t.jsx)(n.p,{children:"Beside Kraken built-in tools, it is possible to use external, your\nown, custom tools. They need to be written as python library with\nspecific metadata and they need to fulfil expected protocol of\nexecution."}),"\n",(0,t.jsxs)(n.p,{children:["More about custom tools in ",(0,t.jsx)(n.a,{href:"tools#custom-tools",children:"Tools"})," chapter."]}),"\n",(0,t.jsx)(n.h2,{id:"environment-in-job",children:"Environment in Job"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"environment"})," define the surroundings of a ",(0,t.jsx)(n.code,{children:"job"})," execution. Each ",(0,t.jsx)(n.code,{children:"job"}),"\nhas one or more ",(0,t.jsx)(n.code,{children:"environment"}),"s defined."]}),"\n",(0,t.jsx)(n.p,{children:"Environment has the following fields:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"agents_group"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"executor"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"system"})}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"config"})," - not implemented yet"]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"There can be many job instances. For each environment and for each\nsystem in environment there is an instance of the job."}),"\n",(0,t.jsx)(n.h3,{id:"agents-groups",children:"Agents Groups"}),"\n",(0,t.jsxs)(n.p,{children:["This is a name of agents group that should be used by scheduler for\nagent selection.  Selected agent from this group will be assigned to\ngiven job and will be used to execute the job. There is a special\nbuilt-in group,",(0,t.jsx)(n.code,{children:"'all'"}),", that gathers all agents."]}),"\n",(0,t.jsx)(n.h3,{id:"executors",children:"Executors"}),"\n",(0,t.jsx)(n.p,{children:"This is an executor type that agent will use to execute a job. It\ncan be one of:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"'local'"})," - an egent is executing a job directly on current host\nsystem where agent is also running"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"'docker'"})," - an agent is executing a job inside of dedicated, just\nspawned Docker container; after the execution the container is\nkilled and removed"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"'lxd'"})," - an agent is executing a job inside of dedicated, just\nspawned LXD container; after the execution the container is\nstopped and removed"]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["Default is ",(0,t.jsx)(n.code,{children:"'local'"}),"."]}),"\n",(0,t.jsx)(n.h3,{id:"systems",children:"Systems"}),"\n",(0,t.jsx)(n.p,{children:"This field can hold an operating system name or list of such names\nthat are used for job execution. If this is a list then the number of\njob instances is multiplied by numer of systems - each instance has\nits system."}),"\n",(0,t.jsxs)(n.p,{children:["There is a special system name, ",(0,t.jsx)(n.code,{children:"'any'"}),", that in case of ",(0,t.jsx)(n.code,{children:"'local'"}),"\nexecutor ignores system selection by jobs scheduler. In other executor\ntypes ",(0,t.jsx)(n.code,{children:"'any'"})," has no special meaning."]}),"\n",(0,t.jsx)(n.p,{children:"The system name has different meaning depending on executor type."}),"\n",(0,t.jsxs)(n.p,{children:["In case of ",(0,t.jsx)(n.code,{children:"'local'"})," executor the system name must match with the system\nreported by agent wher it is running."]}),"\n",(0,t.jsxs)(n.p,{children:["In case of ",(0,t.jsx)(n.code,{children:"'docker'"})," executor the system name is a name of Docker\nimage from ",(0,t.jsx)(n.a,{href:"https://hub.docker.com/",children:"Docker Hub"})," or other Docker\nregistry. Example name: ",(0,t.jsx)(n.code,{children:"'ubuntu:20.04'"}),". There are also Docker images\nspecially crafted for Kraken. The are hosted on Docker Hub:\n",(0,t.jsx)(n.a,{href:"https://hub.docker.com/u/krakenci",children:"https://hub.docker.com/u/krakenci"}),". Example: ",(0,t.jsx)(n.code,{children:"'krakenci/ubuntu:20.04'"}),".\nMore about Docker executor in ",(0,t.jsx)(n.a,{href:"docker-executor",children:"Docker Executor chapter"}),"."]}),"\n",(0,t.jsxs)(n.p,{children:["In case of ",(0,t.jsx)(n.code,{children:"'lxd'"})," executor the system name is a name of LXD image\nfrom ",(0,t.jsx)(n.a,{href:"https://images.linuxcontainers.org/",children:"https://images.linuxcontainers.org/"}),". Example name:\n",(0,t.jsx)(n.code,{children:"'ubuntu/focal/amd64'"}),". To get list of all available LXD container\nnames run ",(0,t.jsx)(n.code,{children:"lxc image list images:"})," command. More about LXD executor\nin ",(0,t.jsx)(n.a,{href:"lxd-executor",children:"LXD Executor chapter"}),"."]}),"\n",(0,t.jsx)(n.p,{children:"Examples:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'"environments": [{\n    "agents_group": "all",\n    "system": "any",\n    "config": "default"\n}]\n'})}),"\n",(0,t.jsx)(n.p,{children:"Pick any agent and use its local host system for job execution."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'"environments": [{\n    "agents_group": "fast",\n    "system": "ubuntu-18.04",\n    "config": "default"\n}]\n'})}),"\n",(0,t.jsxs)(n.p,{children:["Pick an agent from ",(0,t.jsx)(n.code,{children:"'fast'"})," group that runs on ",(0,t.jsx)(n.code,{children:"'ubuntu-18.04'"}),"\noperating system."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'"environments": [{\n    "agents_group": "all",\n    "executor": "docker",\n    "system": ["maven:3.6.3-jdk-11",\n               "fedora:32",\n               "centos:8",\n               "debian:buster",\n               "debian:bullseye",\n               "ubuntu:18.04",\n               "ubuntu:20.04",\n               "krakenci/bld-kraken",\n               "krakenci/ubuntu:20.04",\n               "krakenci/python:3.8",\n               "krakenci/maven:3.6.3-jdk-11"],\n    "config": "default"\n}]\n'})}),"\n",(0,t.jsxs)(n.p,{children:["Create multiple jobs for each indicated system. For each job pick an\nagent from ",(0,t.jsx)(n.code,{children:"'all'"})," group and execute the job in spawned Docker\ncontainer with indicated system image."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'"environments": [{\n    "agents_group": "lxd",\n    "executor": "lxd",\n    "system": "centos/8/amd64",\n    "config": "default"\n}]\n'})}),"\n",(0,t.jsxs)(n.p,{children:["Pick an agent form ",(0,t.jsx)(n.code,{children:"'lxd'"})," group and execute the job in spawned LXD\ncontainer with ",(0,t.jsx)(n.code,{children:"'centos/8/amd64'"})," system image."]}),"\n",(0,t.jsx)(n.p,{children:"More examples can be found at:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://github.com/Kraken-CI/workflow-examples/tree/main/systems-many-docker",children:"https://github.com/Kraken-CI/workflow-examples/tree/main/systems-many-docker"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://github.com/Kraken-CI/workflow-examples/tree/main/systems-many-lxd",children:"https://github.com/Kraken-CI/workflow-examples/tree/main/systems-many-lxd"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://github.com/Kraken-CI/workflow-examples/tree/main/systems-mixed",children:"https://github.com/Kraken-CI/workflow-examples/tree/main/systems-mixed"})}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["More about agents, agent's groups and agent's management can be found in ",(0,t.jsx)(n.a,{href:"agents",children:"Agents chapter"}),"."]}),"\n",(0,t.jsx)(n.h2,{id:"notification",children:"Notification"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"notification"})," allows for configuring a notification means that are\nused to pass an information about stage's run result. There are\nseveral communication methods supported:"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"email"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"slack"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"discord"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"github"})}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"email",children:"Email"}),"\n",(0,t.jsxs)(n.p,{children:["It sends notifications to indicated email address. This requires\nsetting global configuration of SMTP server. This can be found in\n",(0,t.jsx)(n.code,{children:"Settings"})," menu at the top, in ",(0,t.jsx)(n.code,{children:"Notifications"})," tab."]}),"\n",(0,t.jsx)(n.p,{children:"Example:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'"notification": {\n    "email": "godfryd@gmail.com"\n}\n'})}),"\n",(0,t.jsx)(n.h3,{id:"slack",children:"Slack"}),"\n",(0,t.jsxs)(n.p,{children:["It sends notifications to indicated channel on Slack. This requires\nsetting global configuration of an access token to Slack service. This\ncan be found in ",(0,t.jsx)(n.code,{children:"Settings"})," menu at the top, in ",(0,t.jsx)(n.code,{children:"Notifications"})," tab."]}),"\n",(0,t.jsx)(n.p,{children:"Example:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'"notification": {\n    "slack": {"channel": "kk-results"}\n}\n'})}),"\n",(0,t.jsx)(n.h3,{id:"discord",children:"Discord"}),"\n",(0,t.jsx)(n.p,{children:"It sends notifications to indicated channel on Discord. This requires\nsetting a project secret that contains a webhook generated in Discord\nin selected channel."}),"\n",(0,t.jsx)(n.p,{children:"Example:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'"notification": {\n    "discord": {"webhook": "#{secrets.discord_webhook}"}\n}\n'})}),"\n",(0,t.jsx)(n.h3,{id:"github",children:"GitHub"}),"\n",(0,t.jsxs)(n.p,{children:["It sends notifications of stages that were triggered by a GitHub pull\nrequest. It sets results status on PR page on GitHub. This requires\nsetting a configuration on a project page in ",(0,t.jsx)(n.code,{children:"Web Hooks"})," tab. There\nshould be enabled GitHub section and then copied the values or URL and\nsecret and pasted on GitHub project page, in Settings tab, Webhooks\nsubtab."]}),"\n",(0,t.jsxs)(n.p,{children:["GitHub notification section requires setting one field, ",(0,t.jsx)(n.code,{children:"credentials"}),".\nThe credentials are in form ",(0,t.jsx)(n.code,{children:"<user>:<password>"})," e.g.: ",(0,t.jsx)(n.code,{children:"john:1q2w3e4r"}),".\nTo make it safe credentials should be stored and taken from project's\nsecrets. More about secrets in ",(0,t.jsx)(n.a,{href:"secrets",children:"Secrets chapter"}),". GitHub\ncredentials can be prepared on your account developer settings page in\nGitHub (",(0,t.jsx)(n.a,{href:"https://github.com/settings/tokens",children:"https://github.com/settings/tokens"}),"), in Personal access token\nsubtab."]}),"\n",(0,t.jsxs)(n.p,{children:["More about GitHub integration can be found in ",(0,t.jsx)(n.a,{href:"/docs/webhooks",children:"Webhooks chapter"}),"."]}),"\n",(0,t.jsx)(n.p,{children:"Example:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'"notification": {\n    "github": {"credentials": "#{secrets.gh_status_creds}"}\n}\n'})}),"\n",(0,t.jsx)(n.p,{children:"It is also possible to enable all notification means together:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'"notification": {\n    "slack": {"channel": "kk-results"},\n    "email": "godfryd@gmail.com",\n    "github": {"credentials": "#{secrets.gh_status_creds}"}\n}\n'})})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>r,x:()=>l});var t=s(6540);const i={},a=t.createContext(i);function r(e){const n=t.useContext(a);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),t.createElement(a.Provider,{value:n},e.children)}}}]);