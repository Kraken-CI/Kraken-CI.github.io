"use strict";(self.webpackChunkkraken_ci_website=self.webpackChunkkraken_ci_website||[]).push([[8399],{4460:(e,n,o)=>{o.r(n),o.d(n,{assets:()=>a,contentTitle:()=>t,default:()=>p,frontMatter:()=>s,metadata:()=>r,toc:()=>c});var l=o(4848),i=o(8453);o(4074);const s={id:"kkci",title:"Kraken Client Tool"},t=void 0,r={id:"kkci",title:"Kraken Client Tool",description:"Overview",source:"@site/docs/kkci.md",sourceDirName:".",slug:"/kkci",permalink:"/docs/kkci",draft:!1,unlisted:!1,editUrl:"https://github.com/kraken-ci/website/edit/master/docs/kkci.md",tags:[],version:"current",frontMatter:{id:"kkci",title:"Kraken Client Tool"},sidebar:"someSidebar",previous:{title:"Tools",permalink:"/docs/tools"},next:{title:"Migration",permalink:"/docs/migration"}},a={},c=[{value:"Overview",id:"overview",level:2},{value:"Installation",id:"installation",level:2},{value:"Tools Commands",id:"tools-commands",level:2},{value:"tools list",id:"tools-list",level:3},{value:"tools list-versions",id:"tools-list-versions",level:3},{value:"tools register",id:"tools-register",level:3},{value:"tools register-remote",id:"tools-register-remote",level:3},{value:"tools generate-step-file",id:"tools-generate-step-file",level:3},{value:"tools run",id:"tools-run",level:3},{value:"tools upload",id:"tools-upload",level:3},{value:"Auxiliary Commands",id:"auxiliary-commands",level:2},{value:"version",id:"version",level:3},{value:"server-version",id:"server-version",level:3},{value:"dump-workflow-schema",id:"dump-workflow-schema",level:3}];function d(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.code,{children:"kkci"})," is a tool that interacts with Kraken Server. It provides:"]}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.a,{href:"tools",children:"custom tools"})," commands like list tools, register new tool or upload a tool code"]}),"\n",(0,l.jsx)(n.li,{children:"auxiliary commands - like get kkci or server versions"}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"installation",children:"Installation"}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.code,{children:"kkci"})," is hosted on ",(0,l.jsx)(n.a,{href:"https://pypi.org",children:"https://pypi.org"})," and can be installed by ",(0,l.jsx)(n.a,{href:"https://pip.pypa.io/",children:"pip tool"}),"."]}),"\n",(0,l.jsxs)(n.p,{children:["The command for ",(0,l.jsx)(n.code,{children:"kkci"})," installation looks as follows:"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-console",children:"$ pip install krakenci-client==0.980\nCollecting krakenci-client==0.980\n  Using cached krakenci-client-0.980.tar.gz (4.6 kB)\n  Installing build dependencies ... done\n  Getting requirements to build wheel ... done\n  Preparing metadata (pyproject.toml) ... done\nCollecting requests<3.0.0,>=2.26.0\n  Using cached requests-2.28.1-py3-none-any.whl (62 kB)\nCollecting click<8.0.0,>=7.1.2\n  Using cached click-7.1.2-py2.py3-none-any.whl (82 kB)\nCollecting tabulate<0.9.0,>=0.8.9\n  Downloading tabulate-0.8.10-py3-none-any.whl (29 kB)\nCollecting urllib3<1.27,>=1.21.1\n  Using cached urllib3-1.26.10-py2.py3-none-any.whl (139 kB)\nCollecting certifi>=2017.4.17\n  Using cached certifi-2022.6.15-py3-none-any.whl (160 kB)\nCollecting idna<4,>=2.5\n  Using cached idna-3.3-py3-none-any.whl (61 kB)\nCollecting charset-normalizer<3,>=2\n  Using cached charset_normalizer-2.1.0-py3-none-any.whl (39 kB)\nBuilding wheels for collected packages: krakenci-client\n  Building wheel for krakenci-client (pyproject.toml) ... done\n  Created wheel for krakenci-client: filename=krakenci_client-0.980-py3-none-any.whl size=4776 sha256=14c3ffa7b3676949839ddde24b82c6ffaa464dd55d17b69bbb55dffd48976162\n  Stored in directory: /home/godfryd/.cache/pip/wheels/78/10/bb/e935de7562c5b54ca6248247129a728662cab84f0a91ee6192\nSuccessfully built krakenci-client\nInstalling collected packages: urllib3, tabulate, idna, click, charset-normalizer, certifi, requests, krakenci-client\nSuccessfully installed certifi-2022.6.15 charset-normalizer-2.1.0 click-7.1.2 idna-3.3 krakenci-client-0.980 requests-2.28.1 tabulate-0.8.10 urllib3-1.26.10\n"})}),"\n",(0,l.jsxs)(n.p,{children:["It is good to always indicate what ",(0,l.jsx)(n.code,{children:"kkci"})," version should be installed.\nIn the example above, there is ",(0,l.jsx)(n.code,{children:"0.980"})," version installed. The ",(0,l.jsx)(n.code,{children:"kkci"}),"\nversion needs to match the version of Kraken Server otherwise it\nwill not work."]}),"\n",(0,l.jsxs)(n.p,{children:["The list of ",(0,l.jsx)(n.code,{children:"kkci"})," versions can be checked on PyPI profile page:\n",(0,l.jsx)(n.a,{href:"https://pypi.org/project/krakenci-client/#history",children:"https://pypi.org/project/krakenci-client/#history"}),". The version of\nKraken Server is presented on its web pages in the top left corner."]}),"\n",(0,l.jsx)(n.h2,{id:"tools-commands",children:"Tools Commands"}),"\n",(0,l.jsx)(n.h3,{id:"tools-list",children:"tools list"}),"\n",(0,l.jsx)(n.p,{children:"List Kraken Tools the last versions."}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-console",children:"$ kkci -s http://admin:admin@localhost:8080 tools list\n  Id  Name            Location                 Entry    Last Version\n----  --------------  -----------------------  -------  ------------\n   5  artifacts                                         1\n   9  cache                                             1\n   7  cloc                                              1\n   1  git                                               1\n  10  gotest                                            1\n  11  junit_collect                                     1\n  16  local                                             1\n  17  local_tool                                        1\n   8  nglint                                            1\n 131  pkg_install     minio:tool-131/tool.zip  main     48d4c5e\n   6  pylint                                            1\n   3  pytest                                            1\n   4  rndtest                                           1\n   2  shell                                             1\n  12  values_collect                                    1\n"})}),"\n",(0,l.jsx)(n.h3,{id:"tools-list-versions",children:"tools list-versions"}),"\n",(0,l.jsx)(n.p,{children:"List all versions of the given Kraken Tool."}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-console",children:"$ kkci -s http://admin:admin@localhost:8080 tools list-versions pkg_install\n  Id  Name         Location                             Entry    Version\n----  -----------  -----------------------------------  -------  ---------\n 131  pkg_install  minio:tool-131/tool.zip              main     48d4c5e\n 130  pkg_install  /home/godfryd/repos/kraken/pkg-tool  main     dev4\n  98  pkg_install  /home/godfryd/repos/kraken/pkg-tool  main     dev3\n  97  pkg_install  /home/godfryd/repos/kraken/pkg-tool  main     dev2\n  96  pkg_install  /home/godfryd/repos/kraken/pkg-tool  main     dev1\n  95  pkg_install  /home/godfryd/repos/kraken/pkg-tool  main     14119\n  94  pkg_install  /home/godfryd/repos/kraken/pkg-tool  main     dev\n"})}),"\n",(0,l.jsx)(n.h3,{id:"tools-register",children:"tools register"}),"\n",(0,l.jsx)(n.p,{children:"Register a new or overwrite the existing tool described in indicated TOOL_FILE."}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-console",children:"$ kkci -s http://admin:admin@localhost:8080 tools register tool.json\nStored tool pkg_install@dev5\n"})}),"\n",(0,l.jsx)(n.h3,{id:"tools-register-remote",children:"tools register-remote"}),"\n",(0,l.jsx)(n.p,{children:"Register a tool located in a remote repository indicated by URL."}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-console",children:"$ kkci -s http://admin:admin@localhost:8080 tools register-remote \\\n       -f pkg_install/tool.json https://github.com/Kraken-CI/kraken-tools\nStored tool pkg_install@48d4c5e\n"})}),"\n",(0,l.jsx)(n.h3,{id:"tools-generate-step-file",children:"tools generate-step-file"}),"\n",(0,l.jsx)(n.p,{children:"Generate a step file for a tool by indicating its TOOL-FILE. This step\nfile will allow running the tool on a local machine."}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-console",children:"$ kkci tools generate-step-file tool.json\nPlease, enter values for pkg_install tool parameters\n  pkgs (string): asd\n  provider (string, one of ['apt', 'yum', 'dnf', 'apk']): apt\n  aaa (integer): 1\ngit_cfg parameter is complex one, enter its value manually in the step file\n  background (boolean, default False):\nsource parameter is complex one, enter its value manually in the step file\nkeys parameter is complex one, enter its value manually in the step file\nStep file stored to step.json\n"})}),"\n",(0,l.jsx)(n.h3,{id:"tools-run",children:"tools run"}),"\n",(0,l.jsx)(n.p,{children:"Run a tool on a local machine by indicating its TOOL-FILE with step file provide with -f option."}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-console",children:"$ kkci tools run tool.json -f step.json\nexecute 'python3 -m pip install -r requirements.txt --target=./vendor' in '/home/godfryd/repos/kraken-tools/pkg_install'\nCollecting distro\n  Using cached distro-1.7.0-py3-none-any.whl (20 kB)\nInstalling collected packages: distro\nSuccessfully installed distro-1.7.0\nWARNING: You are using pip version 22.0.4; however, version 22.1.2 is available.\nYou should consider upgrading via the '/home/godfryd/.cache/pypoetry/virtualenvs/krakenci-client-gzjv3aIZ-py3.10/bin/python3 -m pip install --upgrade pip' command.\nexecute 'PYTHONPATH=/home/godfryd/repos/kraken-tools/pkg_install:/home/godfryd/repos/kraken-tools/pkg_install/vendor /home/godfryd/.cache/pypoetry/virtualenvs/krakenci-client-gzjv3aIZ-py3.10/bin/python -m kraken.agent.tool -m main -s /home/godfryd/repos/kraken-tools/pkg_install/step.json check-integrity' in 'None'\nexecute 'PYTHONPATH=/home/godfryd/repos/kraken-tools/pkg_install:/home/godfryd/repos/kraken-tools/pkg_install/vendor /home/godfryd/.cache/pypoetry/virtualenvs/krakenci-client-gzjv3aIZ-py3.10/bin/python -m kraken.agent.tool -m main -s /home/godfryd/repos/kraken-tools/pkg_install/step.json get_commands' in 'None'\nexecute 'PYTHONPATH=/home/godfryd/repos/kraken-tools/pkg_install:/home/godfryd/repos/kraken-tools/pkg_install/vendor /home/godfryd/.cache/pypoetry/virtualenvs/krakenci-client-gzjv3aIZ-py3.10/bin/python -m kraken.agent.tool -m main -s /home/godfryd/repos/kraken-tools/pkg_install/step.json run' in 'None'\n2022-07-07 06:35:32,144 run step tool pkg_install, cmd run\n2022-07-07 06:35:32,272 exec: 'sudo dnf -y install mc' in '/home/godfryd/repos/kraken/client'\n2022-07-07 06:35:32,304 output: sudo: dnf: command not found\n2022-07-07 06:35:32,304 step tool pkg_install, cmd run done with retcode 1 in 0secs\n2022-07-07 06:35:32,305 tool response: {\"status\": \"error\", \"reason\": \"retcode\", \"retcode\": 1, \"msg\": \"cmd exited with non-zero retcode: 1\"}\n"})}),"\n",(0,l.jsx)(n.h3,{id:"tools-upload",children:"tools upload"}),"\n",(0,l.jsx)(n.p,{children:"Upload tool's code from DIRECTORY to Kraken Server."}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-console",children:"$ kkci -s http://admin:admin@localhost:8080 tools upload ./pkg-tool/tool.json\nexecute 'python3 -m pip install -r requirements.txt --target=./vendor' in '/home/godfryd/repos/kraken/pkg-tool'\nCollecting pycvs\n  Using cached pycvs-0.0.3-py3-none-any.whl (8.8 kB)\nCollecting colorama\n  Using cached colorama-0.4.5-py2.py3-none-any.whl (16 kB)\nCollecting pexpect\n  Using cached pexpect-4.8.0-py2.py3-none-any.whl (59 kB)\nCollecting ptyprocess>=0.5\n  Using cached ptyprocess-0.7.0-py2.py3-none-any.whl (13 kB)\nInstalling collected packages: ptyprocess, pexpect, colorama, pycvs\nSuccessfully installed colorama-0.4.5 pexpect-4.8.0 ptyprocess-0.7.0 pycvs-0.0.3\nWARNING: You are using pip version 22.0.4; however, version 22.1.2 is available.\nYou should consider upgrading via the '/home/godfryd/.cache/pypoetry/virtualenvs/krakenci-client-gzjv3aIZ-py3.10/bin/python3 -m pip install --upgrade pip' command.\nUploaded tool pkg_install@dev6\n"})}),"\n",(0,l.jsx)(n.h2,{id:"auxiliary-commands",children:"Auxiliary Commands"}),"\n",(0,l.jsx)(n.h3,{id:"version",children:"version"}),"\n",(0,l.jsx)(n.p,{children:"Print a version of kkci."}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-console",children:"$ kkci version\n0.1\n"})}),"\n",(0,l.jsx)(n.h3,{id:"server-version",children:"server-version"}),"\n",(0,l.jsxs)(n.p,{children:["Print a version of Kraken Server indicated in ",(0,l.jsx)(n.code,{children:"-s"})," option."]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-console",children:"$ kkci -s http://admin:admin@localhost:8080 server-version\n0.1\n"})}),"\n",(0,l.jsx)(n.h3,{id:"dump-workflow-schema",children:"dump-workflow-schema"}),"\n",(0,l.jsxs)(n.p,{children:["Dump workflow schema in JSON format from indicated Kraken Server in\n",(0,l.jsx)(n.code,{children:"-s"})," option to indicated file."]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-console",children:"$ kkci -s http://admin:admin@localhost:8080 dump-workflow-schema schema.json\n"})})]})}function p(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(d,{...e})}):d(e)}},4074:(e,n,o)=>{o.d(n,{A:()=>i});o(6540);var l=o(4848);const i=e=>{let{img:n}=e;return(0,l.jsx)("a",{href:"/img/"+n,target:"blank",children:(0,l.jsx)("img",{src:"/img/"+n,style:{boxShadow:"0 10px 10px 5px #777",marginBottom:"30px"}})})}},8453:(e,n,o)=>{o.d(n,{R:()=>t,x:()=>r});var l=o(6540);const i={},s=l.createContext(i);function t(e){const n=l.useContext(s);return l.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:t(e.components),l.createElement(s.Provider,{value:n},e.children)}}}]);