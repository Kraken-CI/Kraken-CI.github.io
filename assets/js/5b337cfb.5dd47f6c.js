"use strict";(self.webpackChunkkraken_ci_website=self.webpackChunkkraken_ci_website||[]).push([[3050],{5364:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>i,default:()=>p,frontMatter:()=>r,metadata:()=>l,toc:()=>d});var t=s(4848),o=s(8453),a=s(4074);s(3012);const r={slug:"conditional-steps",title:"Conditional Steps",authors:"mike",tags:["kraken","devops","cicd"]},i=void 0,l={permalink:"/blog/conditional-steps",editUrl:"https://github.com/kraken-ci/website/edit/master/blog/blog/2023-07-23-conditional-steps.mdx",source:"@site/blog/2023-07-23-conditional-steps.mdx",title:"Conditional Steps",description:"The Kraken version",date:"2023-07-23T00:00:00.000Z",tags:[{label:"kraken",permalink:"/blog/tags/kraken"},{label:"devops",permalink:"/blog/tags/devops"},{label:"cicd",permalink:"/blog/tags/cicd"}],readingTime:1.81,hasTruncateMarker:!0,authors:[{name:"Michal Nowikowski",title:"Kraken Founder. I\u2019m software engineer focused on full-stack programming and improving software processes.",url:"https://www.linkedin.com/in/godfryd",imageURL:"https://avatars1.githubusercontent.com/u/176567?s=460&u=4ade22771af9569be24b20278d24ef60da6eb0bb&v=4",key:"mike"}],frontMatter:{slug:"conditional-steps",title:"Conditional Steps",authors:"mike",tags:["kraken","devops","cicd"]},unlisted:!1,prevItem:{title:"Environment Variables",permalink:"/blog/env-vars"},nextItem:{title:"Data and Dynamism in Schema",permalink:"/blog/data-and-dynamism-in-schema"}},c={authorsImageUrls:[void 0]},d=[];function h(e){const n={a:"a",code:"code",p:"p",pre:"pre",...(0,o.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(n.p,{children:["The Kraken version\n",(0,t.jsx)(n.a,{href:"https://github.com/Kraken-CI/kraken/releases/tag/v1.3",children:"1.3"}),"\nintroduces the conditional steps. This feature enables skipping a step\nunder certain conditions. This condition can be based on any data\navailable in the system including the latest data from previous steps."]}),"\n",(0,t.jsxs)(n.p,{children:["1.3 release brings several more features - check ",(0,t.jsx)(n.a,{href:"https://github.com/Kraken-CI/kraken/releases/tag/v1.3",children:"the release\nnotes"}),"."]}),"\n",(0,t.jsx)(n.p,{children:"More details about the conditional steps are below."}),"\n",(0,t.jsxs)(n.p,{children:["The conditional steps rely on lazy step execution. Previously, all\nsteps were sent to an agent, and the agent executed them all at once\nuntil either all steps were executed or one of the steps failed. Now,\nsteps are sent from the server to an agent one by one. So, the server\nfirst evaluates the ",(0,t.jsx)(n.code,{children:"when"})," condition and decides if the step should be\nsent for execution to an agent."]}),"\n",(0,t.jsxs)(n.p,{children:["The example below shows various cases of ",(0,t.jsx)(n.code,{children:"when"})," condition:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'def stage(ctx):\n  return {\n    "parent": "root",\n      "triggers": {\n        "parent": True,\n      },\n      "parameters": [],\n      "configs": [],\n      "jobs": [{\n        "name": "hello world",\n        "steps": [{\n          "tool": "shell",\n          "cmd": "echo \'hello world\'"\n        }, {\n          "when": "was_no_error",\n          "tool": "shell",\n          "cmd": "echo \'was_no_error\'"\n        }, {\n          "when": "was_any_error",\n          "tool": "shell",\n          "cmd": "echo \'was_any_error\'"\n        }, {\n          "when": "is_ci",\n          "tool": "shell",\n          "cmd": "echo \'is_ci\'"\n        }, {\n          "when": "is_dev",\n          "tool": "shell",\n          "cmd": "echo \'is_dev\'"\n        }, {\n          "tool": "shell",\n          "cmd": "missing-command-xyz"\n        }, {\n          "when": "was_no_error",\n          "tool": "shell",\n          "cmd": "echo \'was_no_error 2\'"\n        }, {\n          "when": "was_any_error",\n          "tool": "shell",\n          "cmd": "echo \'was_any_error 2\'"\n        }, {\n          "when": "always",\n          "tool": "shell",\n          "cmd": "echo \'hello world always\' && sleep 5"\n        }, {\n          "when": "job.steps[step.index - 1].result.duration > 3",\n          "tool": "shell",\n          "cmd": "echo \'hello world #{job.steps[step.index - 1].result}\'"\n        }],\n        "environments": [{\n          "system": "any",\n          "agents_group": "all",\n          "config": "default"\n        }]\n      }]\n    }\n'})}),"\n",(0,t.jsxs)(n.p,{children:["This code can also be found at\n",(0,t.jsx)(n.a,{href:"https://github.com/Kraken-CI/workflow-examples/tree/main/conditional-steps/one.py",children:"https://github.com/Kraken-CI/workflow-examples/tree/main/conditional-steps/one.py"}),"."]}),"\n",(0,t.jsx)(n.p,{children:"The screenshot below shows the status of these steps execution."}),"\n",(0,t.jsx)(a.A,{img:"screen-conditional-steps.png"}),"\n",(0,t.jsxs)(n.p,{children:["The usage of several built-in variables can be observed, such as\n",(0,t.jsx)(n.code,{children:"always"}),", ",(0,t.jsx)(n.code,{children:"is_ci"}),", ",(0,t.jsx)(n.code,{children:"is_dev"}),", ",(0,t.jsx)(n.code,{children:"was_no_error"}),", and ",(0,t.jsx)(n.code,{children:"was_any_error"}),". The\nlast step presents a more complicated case. It utilizes ",(0,t.jsx)(n.code,{children:"job.steps"}),"\nand ",(0,t.jsx)(n.code,{children:"step.index"})," to verify the outcome of the previous step,\nspecifically checking if the duration of the previous step was greater\nthan 3 seconds. If this condition is met, the current step will be\nexecuted."]})]})}function p(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(h,{...e})}):h(e)}},4074:(e,n,s)=>{s.d(n,{A:()=>o});s(6540);var t=s(4848);const o=e=>{let{img:n}=e;return(0,t.jsx)("a",{href:"/img/"+n,target:"blank",children:(0,t.jsx)("img",{src:"/img/"+n,style:{boxShadow:"0 10px 10px 5px #777",marginBottom:"30px"}})})}}}]);